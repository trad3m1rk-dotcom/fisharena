<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>FishArena - Control Real Fishing Rods Online | Remote Fishing Experience</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ£</text></svg>">
    
    <meta name="description" content="Control real fishing rods remotely online! Join FishArena and experience real fishing from anywhere. Live streams, real catches, competitive leaderboards.">
    <meta name="keywords" content="online fishing, remote fishing, fishing game, live fishing, control fishing rod, fishing stream, competitive fishing">
    <meta name="author" content="FishArena">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://trad3m1rk-dotcom.github.io/fisharena/">
    <meta property="og:title" content="FishArena - Control Real Fishing Rods Online">
    <meta property="og:description" content="Experience real fishing remotely! Control actual fishing rods, catch real fish, compete with others.">
    <meta property="og:image" content="https://trad3m1rk-dotcom.github.io/fisharena/og-image.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://trad3m1rk-dotcom.github.io/fisharena/">
    <meta property="twitter:title" content="FishArena - Control Real Fishing Rods Online">
    <meta property="twitter:description" content="Experience real fishing remotely! Control actual fishing rods, catch real fish, compete with others.">
    <meta property="twitter:image" content="https://trad3m1rk-dotcom.github.io/fisharena/twitter-image.jpg">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX'); // Replace with your actual GA4 ID
    </script>
    
    <!-- Stripe SDK -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Firebase v8 SDK - works on GitHub Pages -->
    <script defer src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <style>
        .hidden {
            display: none !important;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0e27;
            color: #fff;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* ANIMATED BACKGROUND */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }

        .content-wrapper {
            position: relative;
            z-index: 1;
        }

        /* GLASSMORPHISM */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        /* PAGE MANAGEMENT */
        .page {
            display: none;
            min-height: 100vh;
            opacity: 0;
            animation: fadeOut 0.3s ease;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.4s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* ============ LOGIN PAGE ============ */
        .login-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: rgba(10, 14, 39, 0.85);
            backdrop-filter: blur(25px);
            border-radius: 30px;
            padding: 70px 60px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.8),
                        0 0 100px rgba(102, 126, 234, 0.3);
            width: 100%;
            max-width: 520px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            animation: fadeInScale 0.6s ease;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .logo {
            text-align: center;
            margin-bottom: 60px;
            cursor: pointer;
        }

        .logo h1 {
            font-size: 3.5em;
            margin-bottom: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            animation: glow 2s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }

        @keyframes glow {
            0%, 100% {
                filter: brightness(1);
            }
            50% {
                filter: brightness(1.3);
            }
        }

        .logo p {
            opacity: 0.95;
            font-size: 1.3em;
            color: #a8b3cf;
        }

        .form-group {
            margin-bottom: 32px;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            opacity: 0.95;
            font-size: 1.1em;
            color: #a8b3cf;
        }

        .form-group input {
            width: 100%;
            padding: 20px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255,255,255,0.1);
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.4);
        }

        .form-group input::placeholder {
            color: rgba(168, 179, 207, 0.5);
        }

        .btn-primary {
            width: 100%;
            padding: 22px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.4em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.8);
        }

        .divider {
            text-align: center;
            margin: 40px 0;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 42%;
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(102, 126, 234, 0.5), transparent);
        }

        .divider::before {
            left: 0;
        }

        .divider::after {
            right: 0;
        }

        .divider span {
            background: rgba(10, 14, 39, 0.9);
            padding: 0 20px;
            opacity: 0.9;
            color: #a8b3cf;
        }

        .social-login {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .btn-social {
            width: 100%;
            padding: 20px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .btn-social:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* ============ HEADER ============ */
        .header {
            padding: 30px 60px;
            background: rgba(10, 14, 39, 0.8);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
        }

        .header .logo h1 {
            font-size: 2.5em;
            margin: 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .header .logo h1:hover {
            transform: scale(1.05);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .balance {
            background: linear-gradient(135deg, rgba(67, 233, 123, 0.2) 0%, rgba(56, 249, 215, 0.2) 100%);
            padding: 15px 30px;
            border-radius: 15px;
            border: 2px solid #43e97b;
            font-weight: bold;
            font-size: 1.35em;
            box-shadow: 0 5px 20px rgba(67, 233, 123, 0.4);
            animation: pulse-balance 2s infinite;
        }

        @keyframes pulse-balance {
            0%, 100% {
                box-shadow: 0 5px 20px rgba(67, 233, 123, 0.4);
            }
            50% {
                box-shadow: 0 5px 30px rgba(67, 233, 123, 0.7);
            }
        }

        .add-balance-btn {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(67, 233, 123, 0.4);
            font-size: 1.1em;
        }

        .add-balance-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.6);
        }

        @media (max-width: 768px) {
            .add-balance-btn {
                padding: 10px 18px;
                font-size: 0.95em;
            }
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
        }

        .user-avatar:hover {
            transform: scale(1.15) rotate(5deg);
        }

        /* ============ DASHBOARD ============ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 30px;
        }

        .page-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .page-title h2 {
            font-size: 3.8em;
            margin-bottom: 20px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-title p {
            font-size: 1.5em;
            opacity: 0.9;
            color: #a8b3cf;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 70px;
            margin-bottom: 70px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(15px);
            padding: 35px 60px;
            border-radius: 20px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .stat-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 50px rgba(102, 126, 234, 0.5);
        }

        .stat-value {
            font-size: 3.2em;
            font-weight: bold;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            opacity: 0.95;
            margin-top: 12px;
            font-size: 1.2em;
            color: #a8b3cf;
        }

        /* CASINO GRID */
        .rods-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 35px;
            max-width: 1700px;
            margin: 0 auto;
        }

        @media (max-width: 1200px) {
            .rods-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .rods-grid {
                grid-template-columns: 1fr;
            }
        }

        .rod-table {
            background: rgba(10, 14, 39, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            overflow: hidden;
            border: 3px solid rgba(102, 126, 234, 0.3);
            transition: all 0.4s ease;
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .rod-table:hover {
            transform: translateY(-15px) scale(1.02);
            border-color: #667eea;
            box-shadow: 0 30px 70px rgba(102, 126, 234, 0.6);
        }

        .rod-table.available {
            border-color: #43e97b;
        }

        .rod-table.available:hover {
            box-shadow: 0 30px 70px rgba(67, 233, 123, 0.7);
        }

        .rod-table.occupied {
            border-color: #f5576c;
        }

        .rod-table.occupied:hover {
            box-shadow: 0 30px 70px rgba(245, 87, 108, 0.7);
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            background: #000;
            overflow: hidden;
        }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.9) 100%);
        }

        .live-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #f5576c;
            padding: 12px 24px;
            border-radius: 35px;
            font-weight: bold;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 6px 25px rgba(245, 87, 108, 0.8);
        }

        .live-dot {
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            animation: pulse-dot 1.5s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 0 0 10px rgba(255,255,255,0.8);
            }
            50% { 
                opacity: 0.5; 
                transform: scale(1.3);
                box-shadow: 0 0 20px rgba(255,255,255,1);
            }
        }

        .rod-number {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(10, 14, 39, 0.9);
            padding: 12px 24px;
            border-radius: 35px;
            font-weight: bold;
            font-size: 1.2em;
        }

        .viewers-count {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(10, 14, 39, 0.9);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rod-info {
            padding: 30px;
            background: rgba(10, 14, 39, 0.6);
        }

        .rod-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .status-badge {
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.05em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-available {
            background: rgba(67, 233, 123, 0.3);
            color: #43e97b;
            border: 2px solid #43e97b;
            box-shadow: 0 5px 20px rgba(67, 233, 123, 0.4);
        }

        .status-occupied {
            background: rgba(245, 87, 108, 0.3);
            color: #f5576c;
            border: 2px solid #f5576c;
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        .queue-info {
            font-size: 1.05em;
            opacity: 0.9;
            color: #a8b3cf;
        }

        .current-player {
            font-size: 1em;
            opacity: 0.8;
            margin-bottom: 18px;
            color: #a8b3cf;
        }

        .action-btn {
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .btn-play {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            box-shadow: 0 6px 25px rgba(67, 233, 123, 0.6);
        }

        .btn-play:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 35px rgba(67, 233, 123, 0.8);
        }

        .btn-queue {
            background: linear-gradient(135deg, #feca57 0%, #ff9f43 100%);
            color: white;
            box-shadow: 0 6px 25px rgba(254, 202, 87, 0.6);
        }

        .btn-queue:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 35px rgba(254, 202, 87, 0.8);
        }

        /* ============ ROD LOBBY ============ */
        .status-bar {
            background: rgba(10, 14, 39, 0.7);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 25px;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 8px;
            color: #a8b3cf;
        }

        .status-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .main-content {
            display: block;
            margin-bottom: 30px;
        }

        @media (max-width: 968px) {
            .main-content {
                display: block;
            }
        }

        .video-section {
            background: rgba(10, 14, 39, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            margin-bottom: 25px;
        }

        .control-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 22px;
            border-radius: 18px;
            color: white;
            font-size: 1.15em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 25px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .control-btn:hover::before {
            left: 100%;
        }

        .control-btn:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 35px rgba(0,0,0,0.6);
        }

        .control-btn:active:not(:disabled) {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* SIMPLE CLEAN CONTROL BUTTONS */
        .control-btn-simple {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 15px;
            padding: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 90px;
        }

        .control-btn-simple:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.5) 0%, rgba(118, 75, 162, 0.5) 100%);
            border-color: rgba(102, 126, 234, 0.8);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .control-btn-simple:active {
            transform: translateY(0);
        }

        /* FEATURE CARDS */
        .feature-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .feature-card:hover::before {
            left: 100%;
        }

        /* SIMPLE BOOST BUTTONS */
        .boost-btn-simple {
            border: none;
            border-radius: 15px;
            padding: 20px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .boost-btn-simple:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .boost-btn-simple:active {
            transform: translateY(-2px);
        }

        /* SIMPLE ACTION BUTTONS */
        .action-btn-simple {
            border: none;
            border-radius: 15px;
            padding: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            min-height: 75px;
        }

        .action-btn-simple:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .action-btn-simple:active {
            transform: translateY(0);
        }

        /* D-PAD STYLES */
        .dpad-btn {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dpad-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .dpad-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
        }

        /* NEW IMPROVED D-PAD */
        .dpad-btn-new {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            font-size: 2.5em;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5), inset 0 1px 3px rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .dpad-btn-new::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.2) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .dpad-btn-new:hover {
            transform: scale(1.15) translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.7), inset 0 1px 5px rgba(255, 255, 255, 0.5);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .dpad-btn-new:hover::before {
            opacity: 1;
        }

        .dpad-btn-new:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
        }

        /* BOOST BUTTONS */
        .boost-btn-new {
            padding: 20px 25px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 110px;
            position: relative;
            overflow: hidden;
        }

        .boost-btn-new::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.15) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .boost-btn-new:hover {
            transform: scale(1.1) translateY(-5px);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .boost-btn-new:hover::before {
            opacity: 1;
        }

        .boost-btn-new:active {
            transform: scale(1.05);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ROTATION & LOWERING - TOP ROW */
        .control-btn.rotate-left {
            background: linear-gradient(135deg, #a8edea 0%, #667eea 100%);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .control-btn.lower-rod {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .control-btn.rotate-right {
            background: linear-gradient(135deg, #667eea 0%, #a8edea 100%);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        /* BOOSTS - BOTTOM ROW */
        .control-btn.boost {
            border: 3px solid rgba(255, 215, 0, 0.5);
        }

        .control-btn.boost.cast {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 6px 25px rgba(245, 87, 108, 0.6);
        }

        .control-btn.boost.reel {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 6px 25px rgba(79, 172, 254, 0.6);
        }

        .control-btn.boost.hook {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            box-shadow: 0 6px 25px rgba(67, 233, 123, 0.6);
        }

        .control-btn.boost.turbo {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            box-shadow: 0 6px 25px rgba(250, 112, 154, 0.6);
            animation: turbo-pulse 2s infinite;
            grid-column: span 2;
        }

        @keyframes turbo-pulse {
            0%, 100% {
                box-shadow: 0 6px 25px rgba(250, 112, 154, 0.6);
            }
            50% {
                box-shadow: 0 6px 40px rgba(250, 112, 154, 0.9);
            }
        }

        /* END SESSION & FULLSCREEN */
        .control-btn.end-session {
            background: linear-gradient(135deg, #f5576c 0%, #c0392b 100%);
            box-shadow: 0 6px 25px rgba(245, 87, 108, 0.6);
        }

        .control-btn.fullscreen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .control-icon {
            font-size: 2.2em;
            filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4));
        }

        .control-label {
            font-size: 0.8em;
            opacity: 0.95;
        }

        .boost-price {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.5);
        }

        .keyboard-hint {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.7em;
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .refund-hint {
            font-size: 0.7em;
            opacity: 0.8;
            color: #43e97b;
        }

        /* FULLSCREEN MODE */
        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            background: #0a0e27;
        }

        .fullscreen-mode .video-section {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .fullscreen-mode .video-container {
            flex: 1;
            padding-bottom: 0 !important;
        }

        .fullscreen-mode .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 1200px;
            background: rgba(10, 14, 39, 0.95);
            padding: 20px;
            border-radius: 20px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .queue-section {
            background: rgba(10, 14, 39, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            border: 2px solid rgba(102, 126, 234, 0.3);
            margin-top: 30px;
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 22px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        .queue-list {
            list-style: none;
        }

        .queue-item {
            background: rgba(255,255,255,0.05);
            padding: 16px;
            margin-bottom: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .queue-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
        }


        .chat-input button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .timer {
            font-size: 3.5em;
            text-align: center;
            font-weight: bold;
            color: #4facfe;
            text-shadow: 0 0 20px rgba(79, 172, 254, 0.8);
        }

        .timer.warning {
            color: #f5576c;
            animation: pulse-timer 1s infinite;
        }

        @keyframes pulse-timer {
            0%, 100% { 
                opacity: 1;
                text-shadow: 0 0 20px rgba(245, 87, 108, 0.8);
            }
            50% { 
                opacity: 0.6;
                text-shadow: 0 0 40px rgba(245, 87, 108, 1);
            }
        }

        .telemetry {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .telemetry-item {
            background: rgba(0,0,0,0.5);
            padding: 6px 10px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .telemetry-label {
            font-size: 0.65em;
            opacity: 0.7;
            color: #a8b3cf;
            margin-bottom: 2px;
        }

        .telemetry-value {
            font-size: 0.95em;
            font-weight: bold;
        }

        .crazy-menu {
            background: rgba(10, 14, 39, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            margin-top: 30px;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .crazy-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: 15px;
            margin-top: 22px;
            max-height: 450px;
            overflow-y: auto;
        }

        .crazy-item {
            background: linear-gradient(135deg, rgba(255,100,100,0.25) 0%, rgba(255,150,50,0.25) 100%);
            border: 2px solid rgba(255,100,100,0.4);
            border-radius: 15px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .crazy-item * {
            pointer-events: none;
        }

        .crazy-item:hover {
            transform: translateY(-5px);
            border-color: rgba(255,100,100,0.8);
            box-shadow: 0 10px 30px rgba(255,100,100,0.6);
        }

        .crazy-icon {
            font-size: 2.2em;
            margin-bottom: 12px;
            display: block;
            text-align: center;
        }

        .crazy-name {
            font-size: 0.95em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fff;
            text-align: center;
        }

        .crazy-price {
            font-size: 1.35em;
            color: #43e97b;
            font-weight: bold;
            text-align: center;
        }

        .tier-label {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.8);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.7em;
            font-weight: bold;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(10, 14, 39, 0.95);
            border-radius: 25px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            border: 2px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            max-height: 90vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }
            
            .container {
                padding: 20px 10px;
            }
            
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
            
            /* Header mobile */
            .header {
                padding: 12px 15px;
                flex-wrap: wrap;
            }
            
            .logo h1 {
                font-size: 1.2em;
            }
            
            .user-info {
                gap: 8px;
                flex-wrap: wrap;
            }
            
            .add-balance-btn {
                font-size: 0.8em;
                padding: 8px 12px;
            }
            
            .balance {
                font-size: 0.85em;
            }
            
            .user-avatar {
                width: 35px;
                height: 35px;
            }
            
            /* Status bar mobile - 2x2 grid */
            .status-bar {
                gap: 10px;
                padding: 15px;
                display: grid;
                grid-template-columns: 1fr 1fr;
            }
            
            .status-value {
                font-size: 1.3em !important;
            }
            
            .status-label {
                font-size: 0.75em;
            }
            
            /* Video section mobile */
            .video-section {
                padding: 15px;
            }
            
            .custom-video-player {
                border-radius: 12px !important;
            }
            
            /* CONTROLS MOBILE - VERTICAL STACK */
            #controlsGrid {
                display: flex !important;
                flex-direction: column !important;
                gap: 25px !important;
                padding: 0 10px !important;
            }
            
            /* Movement centered */
            #controlsGrid > div:first-child {
                width: 100%;
                max-width: none;
            }
            
            /* D-Pad stays same size */
            #controlsGrid > div:first-child > div:last-child {
                margin: 0 auto;
            }
            
            /* Quick actions full width */
            #controlsGrid > div:last-child {
                width: 100%;
            }
            
            /* Action buttons smaller */
            .action-btn-simple {
                min-height: 65px !important;
                font-size: 0.8em !important;
                padding: 8px 12px !important;
            }
            
            /* Fullscreen & End Session buttons */
            .controls > div:nth-child(2) {
                grid-template-columns: 1fr !important;
                gap: 12px !important;
            }
            
            .controls > div:nth-child(2) button {
                padding: 14px !important;
                font-size: 0.85em !important;
            }
            
            /* Crazy menu mobile */
            .crazy-menu {
                padding: 15px;
                margin-top: 15px;
            }
            
            .section-title {
                font-size: 1.2em;
                margin-bottom: 15px;
            }
            
            .crazy-items {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 10px !important;
            }
            
            .crazy-item {
                padding: 12px 8px !important;
            }
            
            .crazy-icon {
                font-size: 1.8em !important;
                margin-bottom: 6px !important;
            }
            
            .crazy-name {
                font-size: 0.75em !important;
            }
            
            .crazy-price {
                font-size: 0.95em !important;
            }
            
            .tier-label {
                font-size: 0.6em !important;
                padding: 2px 6px !important;
            }
            
            /* Queue mobile */
            .queue-section {
                padding: 15px;
                margin-top: 15px;
            }
            
            .queue-list {
                gap: 8px;
            }
            
            .queue-item {
                font-size: 0.85em;
                padding: 10px 12px;
            }
            
            /* Rods grid mobile */
            .rods-grid {
                grid-template-columns: 1fr !important;
                gap: 20px;
            }
            
            /* Footer mobile */
            footer {
                padding: 30px 15px !important;
                margin-top: 40px !important;
            }
            
            footer > div {
                flex-direction: column !important;
                text-align: center;
                gap: 15px !important;
            }
            
            footer > div > div:last-child {
                flex-direction: column !important;
                gap: 12px !important;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        .modal-header h2 {
            font-size: 2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            opacity: 1;
            transform: rotate(90deg);
        }

        .profile-section {
            margin-bottom: 25px;
        }

        .profile-section h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #a8b3cf;
        }

        .profile-info {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .profile-info label {
            display: block;
            opacity: 0.8;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .profile-info input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 1em;
        }

        .profile-info input:focus {
            outline: none;
            border-color: #667eea;
        }

        .profile-info p {
            color: #a8b3cf;
            margin-bottom: 8px;
        }

        /* TOAST NOTIFICATIONS */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            min-width: 300px;
            max-width: 450px;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            z-index: 10000;
            animation: toastSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 4px solid;
        }

        .toast.success {
            border-left-color: #43e97b;
            background: linear-gradient(135deg, rgba(67, 233, 123, 0.15) 0%, rgba(10, 14, 39, 0.95) 50%);
        }

        .toast.error {
            border-left-color: #f5576c;
            background: linear-gradient(135deg, rgba(245, 87, 108, 0.15) 0%, rgba(10, 14, 39, 0.95) 50%);
        }

        .toast.warning {
            border-left-color: #f9ca24;
            background: linear-gradient(135deg, rgba(249, 202, 36, 0.15) 0%, rgba(10, 14, 39, 0.95) 50%);
        }

        .toast.info {
            border-left-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(10, 14, 39, 0.95) 50%);
        }

        .toast-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
            color: white;
            font-size: 15px;
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: rgba(255,255,255,0.5);
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: 0.2s;
        }

        .toast-close:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        @keyframes toastSlideIn {
            from {
                transform: translateX(500px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes toastSlideOut {
            to {
                transform: translateX(500px);
                opacity: 0;
            }
        }

        @keyframes crazyPop {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0) rotate(360deg);
                opacity: 0;
            }
        }


        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(20px);
            padding: 28px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            z-index: 1000;
            animation: slideIn 0.4s ease;
            border: 2px solid rgba(102, 126, 234, 0.5);
        }

        @keyframes slideIn {
            from {
                transform: translateX(500px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .start-btn {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            border: none;
            padding: 32px 70px;
            font-size: 1.8em;
            font-weight: bold;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(67, 233, 123, 0.6);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .start-btn:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 50px rgba(67, 233, 123, 0.9);
        }

        .video-overlay-start {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }

        .video-overlay-start.hidden {
            display: none;
        }

        /* LOW BALANCE WARNING */
        .low-balance-warning {
            background: rgba(245, 87, 108, 0.2);
            border: 2px solid #f5576c;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            animation: pulse-warning 2s infinite;
        }

        @keyframes pulse-warning {
            0%, 100% {
                box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
            }
            50% {
                box-shadow: 0 5px 30px rgba(245, 87, 108, 0.7);
            }
        }

        /* ============ MOBILE RESPONSIVE ============ */
        @media (max-width: 768px) {
            .header {
                padding: 15px 10px;
                flex-direction: column;
                gap: 15px;
            }

            .logo h1 {
                font-size: 1.5em;
            }

            .user-info {
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
                width: 100%;
            }

            .add-balance-btn {
                padding: 8px 15px;
                font-size: 0.85em;
            }

            .balance {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .user-avatar {
                width: 35px;
                height: 35px;
                font-size: 1.2em;
            }

            .user-info button[onclick="logout()"] {
                padding: 8px 15px !important;
                font-size: 0.85em !important;
                margin-left: 0 !important;
            }

            .page-title h2 {
                font-size: 1.8em;
            }

            .page-title p {
                font-size: 0.9em;
            }

            .stats-bar {
                flex-direction: column;
                gap: 15px;
            }

            .rods-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .login-container {
                padding: 40px 30px;
                max-width: 95%;
            }

            .logo h1 {
                font-size: 2.5em;
            }

            .modal-content {
                width: 95%;
                max-width: 95%;
                margin: 20px auto;
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        @media (max-width: 480px) {
            .logo h1 {
                font-size: 1.3em;
            }

            .balance {
                font-size: 0.85em;
            }

            .page-title h2 {
                font-size: 1.5em;
            }

            .user-info {
                font-size: 0.9em;
            }
        }

        /* ============ PROFILE PAGE STYLES ============ */
        .profile-page {
            padding: 40px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .profile-hero {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 60px;
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .profile-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .profile-avatar-section {
            position: relative;
            z-index: 1;
            margin-bottom: 30px;
        }

        .profile-avatar-large {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            margin: 0 auto 20px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .profile-avatar-large:hover {
            transform: scale(1.05);
        }

        .avatar-upload-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: #667eea;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid #0a0e27;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .avatar-upload-btn:hover {
            background: #764ba2;
            transform: scale(1.1);
        }

        .profile-name {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .profile-email {
            color: #a8b3cf;
            font-size: 1.1em;
            position: relative;
            z-index: 1;
        }

        .profile-badges {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .badge.vip {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-color: #f5576c;
        }

        .badge.veteran {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            border-color: #fee140;
        }

        .profile-content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .profile-section-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .achievements-list {
            display: grid;
            gap: 15px;
        }

        .achievement-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .achievement-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .achievement-icon {
            font-size: 2.5em;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            border-radius: 15px;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .achievement-desc {
            font-size: 0.9em;
            color: #a8b3cf;
        }

        .achievement-date {
            font-size: 0.85em;
            color: #667eea;
        }

        .achievement-locked {
            opacity: 0.4;
        }

        .password-change-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-group-modern {
            margin-bottom: 20px;
        }

        .form-group-modern label {
            display: block;
            margin-bottom: 8px;
            color: #a8b3cf;
            font-size: 0.9em;
            font-weight: 500;
        }

        .form-group-modern input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group-modern input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(0, 0, 0, 0.4);
        }

        .quick-actions {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }

        .quick-action-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1em;
        }

        .quick-action-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        @media (max-width: 1024px) {
            .profile-content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .profile-hero {
                padding: 40px 20px;
            }

            .profile-avatar-large {
                width: 120px;
                height: 120px;
                font-size: 3em;
            }

            .profile-name {
                font-size: 1.5em;
            }

            .profile-content-grid {
                grid-template-columns: 1fr;
            }
            
            /* Mobile controls optimization */
            .controls > div:first-child {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }
            
            /* Stack movement and actions vertically on mobile */
            .controls > div:first-child > div:first-child {
                order: 1;
            }
            
            .controls > div:first-child > div:last-child {
                order: 2;
            }
            
            /* Reduce button heights on mobile */
            .controls button {
                height: 60px !important;
                font-size: 0.9em !important;
            }
            
            /* Smaller icons on mobile */
            .controls button > div:first-child {
                font-size: 1.8em !important;
            }
        }

        /* ============ CUSTOM VIDEO PLAYER CONTROLS ============ */
        .custom-video-player {
            position: relative;
            width: 100%;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
        }

        .custom-video-player video,
        .custom-video-player iframe {
            width: 100%;
            height: 100%;
            display: block;
        }

        .video-controls-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .custom-video-player:hover .video-controls-overlay,
        .video-controls-overlay.show {
            opacity: 1;
        }

        .video-controls-top {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, transparent 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .custom-video-player:hover .video-controls-top,
        .video-controls-top.show {
            opacity: 1;
        }

        .video-quality-badge {
            background: rgba(102, 126, 234, 0.9);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .latency-indicator {
            background: rgba(67, 233, 123, 0.9);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .latency-indicator.warning {
            background: rgba(249, 202, 36, 0.9);
        }

        .latency-indicator.bad {
            background: rgba(245, 87, 108, 0.9);
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 15px;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            width: 0%;
            position: relative;
            transition: width 0.1s linear;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.8);
        }

        .progress-container:hover .progress-bar::after {
            width: 16px;
            height: 16px;
            right: -8px;
        }

        .video-controls-bottom {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .video-control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: #fff;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .video-control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .video-control-btn.large {
            width: 50px;
            height: 50px;
            font-size: 1.5em;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 0;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .volume-container:hover .volume-slider {
            width: 80px;
            opacity: 1;
        }

        .volume-slider input {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        .time-display {
            font-size: 0.9em;
            color: #fff;
            font-weight: 500;
            min-width: 100px;
            text-align: center;
        }

        .video-spacer {
            flex: 1;
        }

        .settings-menu {
            position: absolute;
            bottom: 60px;
            right: 20px;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            min-width: 200px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 11;
        }

        .settings-menu.show {
            opacity: 1;
            pointer-events: all;
        }

        .settings-menu-item {
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-menu-item:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .settings-menu-item.active {
            background: rgba(102, 126, 234, 0.3);
            color: #667eea;
        }

        .video-center-play {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(102, 126, 234, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 9;
        }

        .video-center-play.show {
            opacity: 1;
        }

        .video-center-play:hover {
            background: rgba(118, 75, 162, 0.9);
            transform: translate(-50%, -50%) scale(1.1);
        }

        @media (max-width: 768px) {
            .video-controls-bottom {
                gap: 8px;
            }

            .video-control-btn {
                width: 35px;
                height: 35px;
                font-size: 1em;
            }

            .video-control-btn.large {
                width: 45px;
                height: 45px;
                font-size: 1.3em;
            }

            .time-display {
                font-size: 0.8em;
                min-width: 80px;
            }

            .volume-container:hover .volume-slider {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <!-- ANIMATED BACKGROUND -->
    <canvas id="particles-js"></canvas>

    <div class="content-wrapper">
        <!-- ============ LOGIN PAGE ============ -->
        <div id="loginPage" class="page active">
            <div class="login-page">
                <div class="login-container">
                    <div class="logo">
                        <h1>ðŸŽ£ FishArena</h1>
                        <p>Control real fishing rods online!</p>
                    </div>

                    <form id="loginForm" onsubmit="event.preventDefault(); handleLogin(); return false;">
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" placeholder="your@email.com" required>
                        </div>

                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                        </div>

                        <div class="form-group" id="referralCodeGroup">
                            <label for="referralCode">Referral Code (Optional)</label>
                            <input type="text" id="referralCode" placeholder="Enter referral code" style="text-transform: uppercase;">
                            <small style="color: #a8b3cf; font-size: 0.85em; display: block; margin-top: 5px;">
                                ðŸ’¡ Have a referral code? Get +â‚¬2 bonus!
                            </small>
                        </div>

                        <button type="submit" class="btn-primary" id="loginBtn">
                            Login ðŸš€
                        </button>
                        
                        <button type="button" class="btn-primary" onclick="handleSignup()" style="margin-top: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            Sign Up ðŸ“
                        </button>
                    </form>

                    <div class="divider">
                        <span>or</span>
                    </div>

                    <div class="social-login">
                        <button class="btn-social" onclick="handleSocialLogin()">
                            Sign in with Google
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ DASHBOARD PAGE ============ -->
        <div id="dashboardPage" class="page">
            <div class="header">
                <div class="logo">
                    <h1 onclick="showDashboard()">ðŸŽ£ FishArena</h1>
                </div>
                <div class="user-info">
                    <button class="add-balance-btn" onclick="addFunds()">ðŸ’³ Add Funds</button>
                    <div class="balance" id="userBalance">ðŸ’° â‚¬<span id="balanceAmount">5000.00</span></div>
                    <div class="user-avatar" onclick="showProfile()">ðŸ‘¤</div>
                    <button onclick="logout()" style="margin-left: 10px; padding: 10px 20px; background: rgba(245, 87, 108, 0.2); border: 1px solid rgba(245, 87, 108, 0.5); border-radius: 10px; color: #f5576c; cursor: pointer; font-weight: 600; transition: 0.3s;">
                        ðŸšª Logout
                    </button>
                </div>
            </div>

            <div class="container">
                <div class="page-title">
                    <h2>Choose Your Fishing Rod</h2>
                    <p>Select a rod and start playing now</p>
                </div>

                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="playersOnline">127</div>
                        <div class="stat-label">Players Online</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">2,341</div>
                        <div class="stat-label">Fish Caught Today</div>
                    </div>
                </div>

                <div class="rods-grid">
                    <!-- ROD 1 -->
                    <div class="rod-table available" onclick="joinRod(1)">
                        <div class="video-container">
                            <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 3em;">
                                ðŸŽ£
                            </div>
                            <div class="video-overlay">
                                <div class="live-badge">
                                    <div class="live-dot"></div>
                                    LIVE
                                </div>
                                <div class="rod-number">Rod #1</div>
                                <div class="viewers-count">
                                    ðŸ‘ï¸ 47 watching
                                </div>
                            </div>
                        </div>
                        <div class="rod-info">
                            <div class="rod-status">
                                <div class="status-badge status-available">
                                    ðŸŸ¢ Available
                                </div>
                                <div class="queue-info">Queue: 0</div>
                            </div>
                            <div class="current-player">No one playing</div>
                            <button class="action-btn btn-play">
                                âš¡ Play Now
                            </button>
                        </div>
                    </div>

                    <!-- ROD 2 -->
                    <div class="rod-table occupied" onclick="joinRod(2)">
                        <div class="video-container">
                            <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); display: flex; align-items: center; justify-content: center; font-size: 3em;">
                                ðŸŽ£
                            </div>
                            <div class="video-overlay">
                                <div class="live-badge">
                                    <div class="live-dot"></div>
                                    LIVE
                                </div>
                                <div class="rod-number">Rod #2</div>
                                <div class="viewers-count">
                                    ðŸ‘ï¸ 82 watching
                                </div>
                            </div>
                        </div>
                        <div class="rod-info">
                            <div class="rod-status">
                                <div class="status-badge status-occupied">
                                    ðŸ”´ Occupied
                                </div>
                                <div class="queue-info">Queue: 3</div>
                            </div>
                            <div class="current-player">Playing: FisherPro_228</div>
                            <button class="action-btn btn-queue">
                                ðŸ“‹ Join Queue
                            </button>
                        </div>
                    </div>

                    <!-- ROD 3 -->
                    <div class="rod-table occupied" onclick="joinRod(3)">
                        <div class="video-container">
                            <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); display: flex; align-items: center; justify-content: center; font-size: 3em;">
                                ðŸŽ£
                            </div>
                            <div class="video-overlay">
                                <div class="live-badge">
                                    <div class="live-dot"></div>
                                    LIVE
                                </div>
                                <div class="rod-number">Rod #3</div>
                                <div class="viewers-count">
                                    ðŸ‘ï¸ 65 watching
                                </div>
                            </div>
                        </div>
                        <div class="rod-info">
                            <div class="rod-status">
                                <div class="status-badge status-occupied">
                                    ðŸ”´ Occupied
                                </div>
                                <div class="queue-info">Queue: 1</div>
                            </div>
                            <div class="current-player">Playing: CatchMaster</div>
                            <button class="action-btn btn-queue">
                                ðŸ“‹ Join Queue
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Feature Cards Section -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 40px; max-width: 800px; margin-left: auto; margin-right: auto;">
                    <!-- Referral Card -->
                    <div onclick="showReferrals()" class="feature-card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%); border: 2px solid rgba(102, 126, 234, 0.3); padding: 20px; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;">
                        <div style="font-size: 2em; margin-bottom: 10px;">ðŸ’°</div>
                        <h3 style="font-size: 1.1em; font-weight: 700; margin-bottom: 8px; color: white;">Referral Program</h3>
                        <p style="color: #a8b3cf; font-size: 0.85em; margin-bottom: 12px;">Invite friends, earn â‚¬2</p>
                        <div style="display: flex; align-items: center; gap: 8px; color: #667eea; font-weight: 600; font-size: 0.9em;">
                            <span>View Details</span>
                            <span style="font-size: 1.1em;">â†’</span>
                        </div>
                    </div>

                    <!-- Leaderboard Card -->
                    <div onclick="showLeaderboard()" class="feature-card" style="background: linear-gradient(135deg, rgba(249, 202, 36, 0.15) 0%, rgba(240, 147, 43, 0.15) 100%); border: 2px solid rgba(249, 202, 36, 0.3); padding: 20px; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;">
                        <div style="font-size: 2em; margin-bottom: 10px;">ðŸ†</div>
                        <h3 style="font-size: 1.1em; font-weight: 700; margin-bottom: 8px; color: white;">Leaderboard</h3>
                        <p style="color: #a8b3cf; font-size: 0.85em; margin-bottom: 12px;">Top fishermen rankings</p>
                        <div style="display: flex; align-items: center; gap: 8px; color: #f9ca24; font-weight: 600; font-size: 0.9em;">
                            <span>View Rankings</span>
                            <span style="font-size: 1.1em;">â†’</span>
                        </div>
                    </div>

                    <!-- Payment History Card -->
                    <div onclick="showHistory()" class="feature-card" style="background: linear-gradient(135deg, rgba(67, 233, 123, 0.15) 0%, rgba(56, 249, 215, 0.15) 100%); border: 2px solid rgba(67, 233, 123, 0.3); padding: 20px; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;">
                        <div style="font-size: 2em; margin-bottom: 10px;">ðŸ“œ</div>
                        <h3 style="font-size: 1.1em; font-weight: 700; margin-bottom: 8px; color: white;">Payment History</h3>
                        <p style="color: #a8b3cf; font-size: 0.85em; margin-bottom: 12px;">View transactions</p>
                        <div style="display: flex; align-items: center; gap: 8px; color: #43e97b; font-weight: 600; font-size: 0.9em;">
                            <span>View History</span>
                            <span style="font-size: 1.1em;">â†’</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ PAYMENT PAGE ============ -->
        <div id="paymentPage" class="page">
            <div class="header">
                <div class="logo">
                    <h1 onclick="showDashboard()">ðŸŽ£ FishArena</h1>
                </div>
                <div class="user-info">
                    <div class="balance" id="paymentBalance">ðŸ’° â‚¬<span id="paymentBalanceAmount">0.00</span></div>
                    <div class="user-avatar" onclick="showProfile()">ðŸ‘¤</div>
                </div>
            </div>

            <div class="container">
                <div class="page-title">
                    <h2>ðŸ’³ Add Funds</h2>
                    <p>Choose amount to add to your balance</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-top: 40px;">
                    
                    <!-- â‚¬3 Option -->
                    <div class="glass" style="padding: 40px; border-radius: 20px; text-align: center; cursor: pointer; transition: 0.3s; border: 2px solid rgba(102, 126, 234, 0.3);" 
                         onclick="processPayment(1)" 
                         onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='#667eea';" 
                         onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(102, 126, 234, 0.3)';">
                        <div style="font-size: 3em; margin-bottom: 15px;">ðŸ’µ</div>
                        <div style="font-size: 2.5em; font-weight: bold; color: #667eea; margin-bottom: 10px;">â‚¬3</div>
                        <div style="color: #a8b3cf; font-size: 0.9em;">Starter Pack</div>
                        <button class="btn-primary" style="margin-top: 20px; width: 100%;">
                            Select â‚¬3
                        </button>
                    </div>

                    <!-- â‚¬10 Option -->
                    <div class="glass" style="padding: 40px; border-radius: 20px; text-align: center; cursor: pointer; transition: 0.3s; border: 2px solid rgba(102, 234, 126, 0.3); position: relative;" 
                         onclick="processPayment(2)" 
                         onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='#66ea82';" 
                         onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(102, 234, 126, 0.3)';">
                        <div style="position: absolute; top: 10px; right: 10px; background: #66ea82; color: #0a0e27; padding: 5px 15px; border-radius: 20px; font-size: 0.8em; font-weight: bold;">POPULAR</div>
                        <div style="font-size: 3em; margin-bottom: 15px;">ðŸ’Ž</div>
                        <div style="font-size: 2.5em; font-weight: bold; color: #66ea82; margin-bottom: 10px;">â‚¬10</div>
                        <div style="color: #a8b3cf; font-size: 0.9em;">Best Value</div>
                        <button class="btn-primary" style="margin-top: 20px; width: 100%; background: linear-gradient(135deg, #66ea82 0%, #43e97b 100%);">
                            Select â‚¬10
                        </button>
                    </div>

                    <!-- â‚¬20 Option -->
                    <div class="glass" style="padding: 40px; border-radius: 20px; text-align: center; cursor: pointer; transition: 0.3s; border: 2px solid rgba(249, 202, 36, 0.3);" 
                         onclick="processPayment(3)" 
                         onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='#f9ca24';" 
                         onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(249, 202, 36, 0.3)';">
                        <div style="font-size: 3em; margin-bottom: 15px;">ðŸ‘‘</div>
                        <div style="font-size: 2.5em; font-weight: bold; color: #f9ca24; margin-bottom: 10px;">â‚¬20</div>
                        <div style="color: #a8b3cf; font-size: 0.9em;">Premium Pack</div>
                        <button class="btn-primary" style="margin-top: 20px; width: 100%; background: linear-gradient(135deg, #f9ca24 0%, #f0932b 100%);">
                            Select â‚¬20
                        </button>
                    </div>

                </div>

                <div style="margin-top: 40px; text-align: center;">
                    <p style="color: #a8b3cf; margin-bottom: 20px;">
                        ðŸ”’ Secure payment powered by <strong style="color: #667eea;">Stripe</strong>
                    </p>
                    <button onclick="showDashboard()" 
                            style="padding: 15px 30px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: white; font-weight: 600; cursor: pointer; transition: 0.3s;">
                        â† Back to Dashboard
                    </button>
                </div>
            </div>
        </div>

        <!-- ============ REFERRALS PAGE ============ -->
        <div id="referralsPage" class="page">
            <div class="header">
                <div class="logo">
                    <h1 onclick="showDashboard()">ðŸŽ£ FishArena</h1>
                </div>
                <div class="user-info">
                    <button class="add-balance-btn" onclick="addFunds()">ðŸ’³ Add Funds</button>
                    <div class="balance" id="referralBalance">ðŸ’° â‚¬<span id="balanceAmount2">5000.00</span></div>
                    <div class="user-avatar" onclick="showProfile()">ðŸ‘¤</div>
                </div>
            </div>

            <div class="container">
                <div class="page-title">
                    <h2>ðŸ’° Referral Program</h2>
                    <p>Invite friends and earn â‚¬2 for each new user</p>
                </div>

                <div class="glass" style="padding: 40px; border-radius: 20px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; font-size: 1.5em;">ðŸ“Š Your Referral Stats</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 2.5em; margin-bottom: 10px;">ðŸ‘¥</div>
                            <div style="font-size: 2em; font-weight: bold; color: #667eea;" id="referralCount">0</div>
                            <div style="color: #a8b3cf; margin-top: 5px;">Referred Users</div>
                        </div>
                        <div style="background: rgba(102, 234, 126, 0.1); padding: 20px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 2.5em; margin-bottom: 10px;">ðŸ’µ</div>
                            <div style="font-size: 2em; font-weight: bold; color: #66ea82;" id="referralEarnings">â‚¬0.00</div>
                            <div style="color: #a8b3cf; margin-top: 5px;">Total Earned</div>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 15px; font-size: 1.3em;">ðŸ”— Your Referral Link</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <input type="text" id="referralLink" readonly 
                               style="flex: 1; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: white; font-family: monospace;">
                        <button onclick="copyReferralLink()" 
                                style="padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; transition: 0.3s;">
                            ðŸ“‹ Copy Link
                        </button>
                    </div>

                    <div style="background: rgba(102, 234, 126, 0.1); padding: 20px; border-radius: 15px; border-left: 4px solid #66ea82;">
                        <h4 style="margin-bottom: 10px; color: #66ea82;">ðŸ’¡ How It Works</h4>
                        <ul style="color: #a8b3cf; line-height: 1.8; padding-left: 20px;">
                            <li>Share your referral link with friends</li>
                            <li>They sign up and get <strong>â‚¬2 bonus</strong></li>
                            <li>When they spend â‚¬5+, you get <strong>â‚¬2</strong></li>
                            <li>When they spend â‚¬20+, you get <strong>â‚¬5 total</strong></li>
                            <li>Earn <strong>10% commission</strong> on Crazy Menu purchases</li>
                        </ul>
                    </div>
                </div>

                <button onclick="showDashboard()" 
                        style="padding: 15px 30px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: white; font-weight: 600; cursor: pointer; transition: 0.3s;">
                    â† Back to Dashboard
                </button>
            </div>
        </div>

        <!-- ============ LEADERBOARD PAGE ============ -->
        <div id="leaderboardPage" class="page">
            <div class="header">
                <div class="logo">
                    <h1 onclick="showDashboard()">ðŸŽ£ FishArena</h1>
                </div>
                <div class="user-info">
                    <button class="add-balance-btn" onclick="addFunds()">ðŸ’³ Add Funds</button>
                    <div class="balance">ðŸ’° â‚¬<span id="leaderboardBalanceAmount">0.00</span></div>
                    <div class="user-avatar" onclick="showProfile()">ðŸ‘¤</div>
                </div>
            </div>

            <div class="container">
                <div class="page-title">
                    <h2>ðŸ† Leaderboard</h2>
                    <p>Top fishermen of the week</p>
                </div>

                <div class="glass" style="padding: 40px; border-radius: 20px; margin-bottom: 30px;">
                    <div style="display: flex; gap: 20px; margin-bottom: 30px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="showLeaderboardTab('fish')" id="leaderboardFishBtn" class="leaderboard-tab active-tab" style="padding: 12px 30px; background: rgba(102, 126, 234, 0.2); border: 2px solid #667eea; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; transition: 0.3s;">
                            ðŸŸ Most Fish
                        </button>
                        <button onclick="showLeaderboardTab('spent')" id="leaderboardSpentBtn" class="leaderboard-tab" style="padding: 12px 30px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 10px; color: white; font-weight: 600; cursor: pointer; transition: 0.3s;">
                            ðŸ’° Top Spenders
                        </button>
                    </div>

                    <div id="leaderboardFishContent" class="leaderboard-content">
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="border-bottom: 2px solid rgba(255,255,255,0.1);">
                                        <th style="padding: 15px; text-align: left; color: #a8b3cf;">Rank</th>
                                        <th style="padding: 15px; text-align: left; color: #a8b3cf;">Player</th>
                                        <th style="padding: 15px; text-align: right; color: #a8b3cf;">Fish Caught</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderboardFishList">
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        <td style="padding: 20px;">
                                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f9ca24 0%, #f0932b 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">ðŸ¥‡</div>
                                        </td>
                                        <td style="padding: 20px;">
                                            <div style="font-weight: 600; font-size: 1.1em;">FishMaster_Pro</div>
                                            <div style="color: #a8b3cf; font-size: 0.9em;">Member since Jan 2025</div>
                                        </td>
                                        <td style="padding: 20px; text-align: right; font-size: 1.3em; font-weight: bold; color: #43e97b;">847</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        <td style="padding: 20px;">
                                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #a8b3cf 0%, #8395a7 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">ðŸ¥ˆ</div>
                                        </td>
                                        <td style="padding: 20px;">
                                            <div style="font-weight: 600; font-size: 1.1em;">CatchKing_21</div>
                                            <div style="color: #a8b3cf; font-size: 0.9em;">Member since Feb 2025</div>
                                        </td>
                                        <td style="padding: 20px; text-align: right; font-size: 1.3em; font-weight: bold; color: #43e97b;">623</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        <td style="padding: 20px;">
                                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #cd7f32 0%, #a0522d 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">ðŸ¥‰</div>
                                        </td>
                                        <td style="padding: 20px;">
                                            <div style="font-weight: 600; font-size: 1.1em;">RodLegend_99</div>
                                            <div style="color: #a8b3cf; font-size: 0.9em;">Member since Jan 2025</div>
                                        </td>
                                        <td style="padding: 20px; text-align: right; font-size: 1.3em; font-weight: bold; color: #43e97b;">571</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="leaderboardSpentContent" class="leaderboard-content" style="display: none;">
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="border-bottom: 2px solid rgba(255,255,255,0.1);">
                                        <th style="padding: 15px; text-align: left; color: #a8b3cf;">Rank</th>
                                        <th style="padding: 15px; text-align: left; color: #a8b3cf;">Player</th>
                                        <th style="padding: 15px; text-align: right; color: #a8b3cf;">Total Spent</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        <td style="padding: 20px;"><div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f9ca24 0%, #f0932b 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">ðŸ¥‡</div></td>
                                        <td style="padding: 20px;"><div style="font-weight: 600; font-size: 1.1em;">WhalePlayer_1</div></td>
                                        <td style="padding: 20px; text-align: right; font-size: 1.3em; font-weight: bold; color: #f9ca24;">â‚¬2,847</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        <td style="padding: 20px;"><div style="width: 40px; height: 40px; background: linear-gradient(135deg, #a8b3cf 0%, #8395a7 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">ðŸ¥ˆ</div></td>
                                        <td style="padding: 20px;"><div style="font-weight: 600; font-size: 1.1em;">MegaSupporter</div></td>
                                        <td style="padding: 20px; text-align: right; font-size: 1.3em; font-weight: bold; color: #a8b3cf;">â‚¬1,623</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <button onclick="showDashboard()" style="padding: 15px 30px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: white; font-weight: 600; cursor: pointer;">
                    â† Back to Dashboard
                </button>
            </div>
        </div>

        <!-- ============ PAYMENT HISTORY PAGE ============ -->
        <div id="historyPage" class="page">
            <div class="header">
                <div class="logo">
                    <h1 onclick="showDashboard()">ðŸŽ£ FishArena</h1>
                </div>
                <div class="user-info">
                    <button class="add-balance-btn" onclick="addFunds()">ðŸ’³ Add Funds</button>
                    <div class="balance">ðŸ’° â‚¬<span id="historyBalanceAmount">0.00</span></div>
                    <div class="user-avatar" onclick="showProfile()">ðŸ‘¤</div>
                </div>
            </div>

            <div class="container">
                <div class="page-title">
                    <h2>ðŸ“œ Payment History</h2>
                    <p>Your transaction history</p>
                </div>

                <div class="glass" style="padding: 40px; border-radius: 20px; margin-bottom: 30px;">
                    <div id="historyList">
                        <!-- Payment history will be loaded here -->
                        <div style="text-align: center; padding: 60px 20px; color: #a8b3cf;">
                            <div style="font-size: 4em; margin-bottom: 20px;">ðŸ“</div>
                            <h3 style="margin-bottom: 10px;">No payments yet</h3>
                            <p>Your payment history will appear here after your first transaction</p>
                            <button onclick="addFunds()" style="margin-top: 20px; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer;">
                                Make First Payment
                            </button>
                        </div>
                    </div>
                </div>

                <button onclick="showDashboard()" style="padding: 15px 30px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: white; font-weight: 600; cursor: pointer;">
                    â† Back to Dashboard
                </button>
            </div>
        </div>

        <!-- ============ ROD LOBBY PAGE ============ -->
        <div id="rodLobbyPage" class="page">
            <div class="header">
                <div class="logo">
                    <h1 onclick="showDashboard()">ðŸŽ£ FishArena</h1>
                </div>
                <div class="user-info">
                    <button class="add-balance-btn" onclick="addFunds()">ðŸ’³ Add Funds</button>
                    <div class="balance" id="lobbyBalance">ðŸ’° â‚¬<span id="lobbyBalanceAmount">5000.00</span></div>
                    <div class="user-avatar" onclick="showProfile()">ðŸ‘¤</div>
                </div>
            </div>

            <div class="container">
                <div id="lowBalanceWarning" class="low-balance-warning" style="display: none;">
                    âš ï¸ <strong>Low Balance!</strong> Add funds to continue playing
                </div>

                <div class="status-bar">
                    <div class="status-item">
                        <div class="status-label">Status</div>
                        <div class="status-value" id="userStatus">In Queue</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Your Time</div>
                        <div class="status-value timer" id="timer">00:00</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Queue Position</div>
                        <div class="status-value" id="queuePosition">3</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Online</div>
                        <div class="status-value" id="onlineCount">47</div>
                    </div>
                </div>

                <div class="main-content">
                    <div class="video-section">
                        <!-- VIDEO PLAYER WITH FISHING STREAM -->
                        <div class="custom-video-player" id="customVideoPlayer" style="position: relative; width: 100%; padding-bottom: 56.25%; background: #000; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
                            <!-- Fishing Video Background -->
                            <video 
                                id="fishingVideo"
                                autoplay 
                                loop 
                                muted 
                                playsinline
                                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; background: #0a0e27;">
                                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                                <!-- Fallback: free stock video from Google Cloud Storage -->
                            </video>
                            
                            <!-- Start Session Button Overlay -->
                            <div id="videoOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.4); z-index: 10; backdrop-filter: blur(8px);">
                                <div style="text-align: center; margin-bottom: 20px;">
                                    <div style="font-size: 3em; margin-bottom: 10px;">ðŸŽ£</div>
                                    <div style="font-size: 1.2em; color: #a8b3cf; margin-bottom: 5px;">Ready to fish?</div>
                                </div>
                                <button onclick="startSession()" style="
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    border: 2px solid rgba(255,255,255,0.2);
                                    padding: 28px 70px;
                                    font-size: 1.6em;
                                    font-weight: 700;
                                    color: white;
                                    border-radius: 16px;
                                    cursor: pointer;
                                    box-shadow: 0 20px 60px rgba(102, 126, 234, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
                                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                                    letter-spacing: 1px;
                                    text-transform: uppercase;
                                    position: relative;
                                    overflow: hidden;
                                " onmouseover="
                                    this.style.transform='translateY(-4px) scale(1.02)'; 
                                    this.style.boxShadow='0 25px 70px rgba(102, 126, 234, 0.7), inset 0 1px 0 rgba(255,255,255,0.3)';
                                " onmouseout="
                                    this.style.transform=''; 
                                    this.style.boxShadow='0 20px 60px rgba(102, 126, 234, 0.5), inset 0 1px 0 rgba(255,255,255,0.2)';
                                ">
                                    <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
                                        <span>ðŸŽ®</span>
                                        <span>Start Session</span>
                                    </div>
                                    <div style="font-size: 0.5em; opacity: 0.85; margin-top: 8px; font-weight: 500; letter-spacing: 0.5px;">
                                        â‚¬0.30/min â€¢ No time limit
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Controls (Movement + Quick Actions) -->
                            <div id="controlsGrid" style="display: grid; grid-template-columns: 260px 1fr; gap: 40px; max-width: 1000px; margin: 0 auto;">
                                
                                <!-- LEFT SIDE: DIRECTIONAL CONTROLS (COMPACT) -->
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <div style="text-align: center; margin-bottom: 15px; color: #a8b3cf; font-weight: 600; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px;">
                                        ðŸŽ® Movement
                                    </div>
                                    
                                    <!-- D-Pad Style Layout -->
                                    <div style="display: grid; grid-template-columns: repeat(3, 80px); gap: 8px; width: fit-content;">
                                        <!-- Empty top left -->
                                        <div></div>
                                        
                                        <!-- Up -->
                                        <button onclick="sendCommand('raise')" 
                                                style="width: 80px; height: 80px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border: none; border-radius: 12px; color: white; font-size: 1.8em; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3); position: relative;">
                                            â¬†ï¸
                                            <div style="position: absolute; top: 4px; right: 4px; font-size: 0.35em; background: rgba(0,0,0,0.3); padding: 2px 5px; border-radius: 4px;">W</div>
                                        </button>
                                        
                                        <!-- Empty top right -->
                                        <div></div>
                                        
                                        <!-- Left -->
                                        <button onclick="sendCommand('rotate-left')" 
                                                style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 12px; color: white; font-size: 1.8em; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); position: relative;">
                                            â†
                                            <div style="position: absolute; top: 4px; right: 4px; font-size: 0.35em; background: rgba(0,0,0,0.3); padding: 2px 5px; border-radius: 4px;">A</div>
                                        </button>
                                        
                                        <!-- Down -->
                                        <button onclick="sendCommand('lower')" 
                                                style="width: 80px; height: 80px; background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%); border: none; border-radius: 12px; color: white; font-size: 1.8em; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3); position: relative;">
                                            â¬‡ï¸
                                            <div style="position: absolute; top: 4px; right: 4px; font-size: 0.35em; background: rgba(0,0,0,0.3); padding: 2px 5px; border-radius: 4px;">S</div>
                                        </button>
                                        
                                        <!-- Right -->
                                        <button onclick="sendCommand('rotate-right')" 
                                                style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 12px; color: white; font-size: 1.8em; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); position: relative;">
                                            â†’
                                            <div style="position: absolute; top: 4px; right: 4px; font-size: 0.35em; background: rgba(0,0,0,0.3); padding: 2px 5px; border-radius: 4px;">D</div>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- RIGHT SIDE: ACTIONS (HORIZONTAL LAYOUT) -->
                                <div>
                                    <div style="text-align: center; margin-bottom: 15px; color: #feca57; font-weight: 700; font-size: 1em; text-transform: uppercase; letter-spacing: 1.5px;">
                                        âš¡ Quick Actions
                                    </div>
                                    
                                    <!-- Action Buttons Grid - HORIZONTAL LIKE FULLSCREEN -->
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                        <!-- Cast -->
                                        <button onclick="buyBoost('cast', 0.50)" 
                                                style="height: 70px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); border: none; border-radius: 18px; color: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 20px rgba(255, 107, 107, 0.4); display: flex; flex-direction: row; align-items: center; gap: 12px; position: relative; padding: 0 20px;">
                                            <div style="font-size: 2.2em;">ðŸŽ£</div>
                                            <div style="flex: 1; text-align: left;">
                                                <div style="font-size: 0.85em; font-weight: 800;">CAST BAIT</div>
                                                <div style="font-size: 0.95em; font-weight: 900; color: #feca57;">â‚¬0.50</div>
                                            </div>
                                            <div style="font-size: 0.65em; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-weight: 700;">1</div>
                                        </button>
                                        
                                        <!-- Reel -->
                                        <button onclick="buyBoost('reel', 0.30)" 
                                                style="height: 70px; background: linear-gradient(135deg, #4ecdc4 0%, #44a3a0 100%); border: none; border-radius: 18px; color: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 20px rgba(78, 205, 196, 0.4); display: flex; flex-direction: row; align-items: center; gap: 12px; position: relative; padding: 0 20px;">
                                            <div style="font-size: 2.2em;">ðŸ”„</div>
                                            <div style="flex: 1; text-align: left;">
                                                <div style="font-size: 0.85em; font-weight: 800;">REEL IN</div>
                                                <div style="font-size: 0.95em; font-weight: 900; color: #feca57;">â‚¬0.30</div>
                                            </div>
                                            <div style="font-size: 0.65em; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-weight: 700;">2</div>
                                        </button>
                                        
                                        <!-- Hook -->
                                        <button onclick="buyBoost('hook', 0.40)" 
                                                style="height: 70px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none; border-radius: 18px; color: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 20px rgba(240, 147, 251, 0.4); display: flex; flex-direction: row; align-items: center; gap: 12px; position: relative; padding: 0 20px;">
                                            <div style="font-size: 2.2em;">âš¡</div>
                                            <div style="flex: 1; text-align: left;">
                                                <div style="font-size: 0.85em; font-weight: 800;">HOOK SET</div>
                                                <div style="font-size: 0.95em; font-weight: 900; color: #feca57;">â‚¬0.40</div>
                                            </div>
                                            <div style="font-size: 0.65em; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-weight: 700;">3</div>
                                        </button>
                                        
                                        <!-- Turbo -->
                                        <button onclick="buyBoost('turbo', 1.00)" 
                                                style="height: 70px; background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%); border: none; border-radius: 18px; color: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 20px rgba(254, 202, 87, 0.4); display: flex; flex-direction: row; align-items: center; gap: 12px; position: relative; padding: 0 20px;">
                                            <div style="font-size: 2.2em;">ðŸš€</div>
                                            <div style="flex: 1; text-align: left;">
                                                <div style="font-size: 0.85em; font-weight: 800;">TURBO REEL</div>
                                                <div style="font-size: 0.95em; font-weight: 900; color: #fff;">â‚¬1.00</div>
                                            </div>
                                            <div style="font-size: 0.65em; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-weight: 700;">4</div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Bottom Utility Bar -->
                            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                    <button onclick="toggleFullscreen()" id="fullscreenBtn"
                                            style="height: 70px; background: linear-gradient(135deg, rgba(118, 75, 162, 0.8) 0%, rgba(102, 126, 234, 0.8) 100%); border: none; border-radius: 18px; color: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 20px rgba(118, 75, 162, 0.4); display: flex; flex-direction: row; align-items: center; gap: 12px; position: relative; padding: 0 20px;">
                                        <div style="font-size: 2.2em;">â›¶</div>
                                        <div style="flex: 1; text-align: left;">
                                            <div style="font-size: 0.85em; font-weight: 800;">FULLSCREEN</div>
                                        </div>
                                        <div style="font-size: 0.65em; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-weight: 700;">F</div>
                                    </button>
                                    
                                    <button onclick="endSessionEarly()" id="endSessionBtn"
                                            style="height: 70px; background: linear-gradient(135deg, rgba(245, 87, 108, 0.8) 0%, rgba(240, 147, 43, 0.8) 100%); border: none; border-radius: 18px; color: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 20px rgba(245, 87, 108, 0.4); display: flex; flex-direction: row; align-items: center; gap: 12px; position: relative; padding: 0 20px;">
                                        <div style="font-size: 2.2em;">ðŸ</div>
                                        <div style="flex: 1; text-align: left;">
                                            <div style="font-size: 0.85em; font-weight: 800;">END SESSION</div>
                                            <div style="font-size: 0.7em; opacity: 0.9;">Get refund</div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                            
                            <style>
                                .controls button:hover {
                                    transform: translateY(-3px);
                                    box-shadow: 0 8px 25px rgba(0,0,0,0.5) !important;
                                }
                                .controls button:active {
                                    transform: translateY(-1px);
                                }
                            </style>
                        </div>

                        <!-- Telemetry removed - not needed -->

                    </div>

                    <!-- Sidebar empty now, queue moved below -->
                </div>

                <!-- CRAZY MENU -->
                <div class="crazy-menu">
                    <h2 class="section-title">ðŸ”¥ CRAZY MENU - Make It Wild!</h2>
                    <div class="crazy-items">
                        <!-- BASE -->
                        <div class="crazy-item" onclick="buyCrazy('wave', 10)">
                            <span class="tier-label">BASE</span>
                            <span class="crazy-icon">ðŸŒŠ</span>
                            <div class="crazy-name">Wave</div>
                            <div class="crazy-price">â‚¬10</div>
                        </div>
                        <div class="crazy-item" onclick="buyCrazy('feed', 15)">
                            <span class="tier-label">BASE</span>
                            <span class="crazy-icon">ðŸŸ</span>
                            <div class="crazy-name">Feed Fish</div>
                            <div class="crazy-price">â‚¬15</div>
                        </div>
                        <div class="crazy-item" onclick="buyCrazy('lights', 20)">
                            <span class="tier-label">BASE</span>
                            <span class="crazy-icon">ðŸ’¡</span>
                            <div class="crazy-name">RGB Lights</div>
                            <div class="crazy-price">â‚¬20</div>
                        </div>
                        
                        <!-- ALCOHOL -->
                        <div class="crazy-item" onclick="buyCrazy('beer', 25)">
                            <span class="tier-label">ðŸº</span>
                            <span class="crazy-icon">ðŸº</span>
                            <div class="crazy-name">Beer</div>
                            <div class="crazy-price">â‚¬25</div>
                        </div>
                        <div class="crazy-item" onclick="buyCrazy('vodka', 20)">
                            <span class="tier-label">ðŸ§Š</span>
                            <span class="crazy-icon">ðŸ§Š</span>
                            <div class="crazy-name">Vodka Shot</div>
                            <div class="crazy-price">â‚¬20</div>
                        </div>
                        <div class="crazy-item" onclick="buyCrazy('champagne', 75)">
                            <span class="tier-label">ðŸ¾</span>
                            <span class="crazy-icon">ðŸ¾</span>
                            <div class="crazy-name">Champagne</div>
                            <div class="crazy-price">â‚¬75</div>
                        </div>
                        
                        <!-- MED -->
                        <div class="crazy-item" onclick="buyCrazy('duck', 50)">
                            <span class="tier-label">MED</span>
                            <span class="crazy-icon">ðŸ¦†</span>
                            <div class="crazy-name">Duck Drop</div>
                            <div class="crazy-price">â‚¬50</div>
                        </div>
                        
                        <!-- EXTREME -->
                        <div class="crazy-item" onclick="buyCrazy('bucket', 300)">
                            <span class="tier-label">EXT</span>
                            <span class="crazy-icon">ðŸª£</span>
                            <div class="crazy-name">Water Bucket</div>
                            <div class="crazy-price">â‚¬300</div>
                        </div>
                        <div class="crazy-item" onclick="buyCrazy('operator-swim', 500)">
                            <span class="tier-label">EXT</span>
                            <span class="crazy-icon">ðŸ’¦</span>
                            <div class="crazy-name">Operator Swim</div>
                            <div class="crazy-price">â‚¬500</div>
                        </div>
                        <div class="crazy-item" onclick="buyCrazy('pike', 1000)">
                            <span class="tier-label">EXT</span>
                            <span class="crazy-icon">ðŸ¦ˆ</span>
                            <div class="crazy-name">Add Pike</div>
                            <div class="crazy-price">â‚¬1000</div>
                        </div>
                        
                        <!-- LEGENDARY -->
                        <div class="crazy-item" onclick="buyCrazy('drain', 2000)">
                            <span class="tier-label">LEG</span>
                            <span class="crazy-icon">ðŸš°</span>
                            <div class="crazy-name">Drain Pool</div>
                            <div class="crazy-price">â‚¬2000</div>
                        </div>
                        <div class="crazy-item" onclick="buyCrazy('mustang', 30000)">
                            <span class="tier-label">LEG</span>
                            <span class="crazy-icon">ðŸŽï¸</span>
                            <div class="crazy-name">Buy Mustang</div>
                            <div class="crazy-price">â‚¬30000</div>
                        </div>
                    </div>
                </div>

                <!-- QUEUE (Below Crazy Menu) -->
                <div class="queue-section" style="margin-top: 30px;">
                    <h2 class="section-title">ðŸ“‹ Queue</h2>
                    <ul class="queue-list">
                        <li class="queue-item">
                            <span>ðŸ‘¤ Fisher_Pro</span>
                            <span>ðŸŽ® Playing</span>
                        </li>
                        <li class="queue-item">
                            <span>ðŸ‘¤ Fisher123</span>
                            <span>â³ 2 min</span>
                        </li>
                        <li class="queue-item active">
                            <span>ðŸ‘¤ You</span>
                            <span>â³ 7 min</span>
                        </li>
                        <li class="queue-item">
                            <span>ðŸ‘¤ CatchMaster</span>
                            <span>â³ 12 min</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ============ PROFILE PAGE ============ -->
        <div id="profilePage" class="page">
            <div class="header">
                <div class="logo">
                    <h1 onclick="showDashboard()">ðŸŽ£ FishArena</h1>
                </div>
                <div class="user-info">
                    <button class="add-balance-btn" onclick="addFunds()">ðŸ’³ Add Funds</button>
                    <div class="balance">ðŸ’° â‚¬<span id="profilePageBalance">0.00</span></div>
                    <div class="user-avatar" onclick="showProfile()">ðŸ‘¤</div>
                </div>
            </div>

            <div class="profile-page">
                <!-- HERO SECTION WITH AVATAR -->
                <div class="profile-hero">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-large" id="profileAvatarLarge" onclick="document.getElementById('avatarUpload').click()">
                            ðŸ‘¤
                            <div class="avatar-upload-btn" title="Change Avatar">ðŸ“·</div>
                        </div>
                        <input type="file" id="avatarUpload" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                        
                        <div class="profile-name" id="profilePageName">Loading...</div>
                        <div class="profile-email" id="profilePageEmail">Loading...</div>
                        
                        <div class="profile-badges">
                            <div class="badge" id="memberBadge">
                                ðŸ“… Member since <span id="profileMemberSinceDate">2024</span>
                            </div>
                            <!-- Dynamic badges will be added here -->
                        </div>

                        <!-- Compact inline stats -->
                        <div style="display: flex; gap: 30px; justify-content: center; margin-top: 25px; flex-wrap: wrap; position: relative; z-index: 1;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: #667eea;" id="profileFishCaughtInline">0</div>
                                <div style="font-size: 0.85em; color: #a8b3cf; text-transform: uppercase; letter-spacing: 1px;">ðŸŸ Fish Caught</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: #764ba2;" id="profileTotalSpentInline">â‚¬0</div>
                                <div style="font-size: 0.85em; color: #a8b3cf; text-transform: uppercase; letter-spacing: 1px;">ðŸ’° Total Spent</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: #667eea;" id="profileReferralsInline">0</div>
                                <div style="font-size: 0.85em; color: #a8b3cf; text-transform: uppercase; letter-spacing: 1px;">ðŸ‘¥ Referrals</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: #764ba2;" id="profilePlaytimeInline">0h</div>
                                <div style="font-size: 0.85em; color: #a8b3cf; text-transform: uppercase; letter-spacing: 1px;">â±ï¸ Playtime</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONTENT GRID -->
                <div class="profile-content-grid">
                    <!-- LEFT COLUMN: PASSWORD CHANGE -->
                    <div>
                        <!-- PASSWORD CHANGE SECTION -->
                        <div class="profile-section-card" style="margin-top: 30px;">
                            <div class="section-header">
                                <div class="section-title">
                                    ðŸ” Security Settings
                                </div>
                            </div>

                            <div class="password-change-section" style="padding-top: 0; border-top: none; margin-top: 0;">
                                <div class="form-group-modern">
                                    <label for="profileNewPassword">New Password</label>
                                    <input type="password" id="profileNewPassword" placeholder="Enter new password (min 6 characters)">
                                </div>
                                
                                <div class="form-group-modern">
                                    <label for="profileConfirmPassword">Confirm New Password</label>
                                    <input type="password" id="profileConfirmPassword" placeholder="Confirm new password">
                                </div>
                                
                                <button class="btn-primary" onclick="changePasswordFromProfile()" style="width: 100%; margin-top: 10px;">
                                    ðŸ” Update Password
                                </button>
                            </div>

                            <div class="quick-actions">
                                <button class="quick-action-btn" onclick="showReferrals()">
                                    ðŸŽ View Referral Program
                                </button>
                                <button class="quick-action-btn" onclick="showHistory()">
                                    ðŸ“œ Payment History
                                </button>
                                <button class="quick-action-btn" onclick="showLeaderboard()">
                                    ðŸ† View Leaderboard
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT COLUMN: ACHIEVEMENTS -->
                    <div>
                        <div class="profile-section-card">
                            <div class="section-header">
                                <div class="section-title">
                                    ðŸ† Achievements
                                </div>
                            </div>

                            <div class="achievements-list" id="achievementsList">
                                <!-- Achievements will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BACK BUTTON -->
                <button onclick="showDashboard()" style="padding: 15px 30px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: white; font-weight: 600; cursor: pointer; width: 100%;">
                    â† Back to Dashboard
                </button>
            </div>
        </div>
    </div>

    <!-- PROFILE MODAL -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ðŸ‘¤ My Profile</h2>
                <button class="close-modal" onclick="closeModal('profileModal')">&times;</button>
            </div>
            
            <div class="profile-section">
                <h3>Account Information</h3>
                <div class="profile-info">
                    <label>Email</label>
                    <input type="email" id="profileEmail" value="" readonly style="background: rgba(255,255,255,0.05);">
                </div>
                <div class="profile-info">
                    <label>Referral Code</label>
                    <input type="text" id="profileRefCode" value="" readonly style="background: rgba(255,255,255,0.05);">
                </div>
                <div class="profile-info">
                    <label>Balance</label>
                    <input type="text" id="profileBalance" value="" readonly style="background: rgba(255,255,255,0.05);">
                </div>
            </div>

            <div class="profile-section">
                <h3>Change Password</h3>
                <div class="profile-info">
                    <label>New Password</label>
                    <input type="password" id="newPassword" placeholder="Enter new password (min 6 chars)">
                </div>
                <div class="profile-info">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm new password">
                </div>
                <button class="btn-primary" onclick="changePassword()" style="margin-top: 10px;">
                    ðŸ” Update Password
                </button>
            </div>

            <div class="profile-section">
                <h3>Statistics</h3>
                <div class="profile-info">
                    <p>Fish Caught: <strong id="profileFishCaught">0</strong></p>
                    <p>Total Spent: <strong id="profileTotalSpent">â‚¬0.00</strong></p>
                    <p>Referred Users: <strong id="profileReferrals">0</strong></p>
                    <p>Member Since: <strong id="profileMemberSince">-</strong></p>
                </div>
            </div>
        </div>
    </div>

    <!-- FAQ MODAL -->
    <div id="faqModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â“ FAQ</h2>
                <button class="close-modal" onclick="closeModal('faqModal')">&times;</button>
            </div>
            
            <div class="profile-section">
                <h3>How does FishArena work?</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">FishArena allows you to control real fishing rods remotely. Select an available rod, start a session (â‚¬0.30/min, no time limit), and use controls or keyboard to fish in real-time!</p>
            </div>

            <div class="profile-section">
                <h3>How much does it cost?</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">A 10-minute session costs â‚¬3.00 (â‚¬0.30/minute). You can end early and get refund for unused time. Boosts cost extra: Cast â‚¬0.50, Reel â‚¬0.30, Hook â‚¬0.40, Turbo â‚¬1.00.</p>
            </div>

            <div class="profile-section">
                <h3>What are the controls?</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">
                    <strong>Free controls:</strong><br>
                    â€¢ W (raise line), S (lower line)<br>
                    â€¢ A (rotate left), D (rotate right)<br>
                    <strong>Paid boosts:</strong> 1 (cast â‚¬0.50), 2 (reel â‚¬0.30), 3 (hook â‚¬0.40), 4 (turbo â‚¬1.00)<br>
                    <strong>Other:</strong> F (fullscreen), End Session button
                </p>
            </div>

            <div class="profile-section">
                <h3>Can I get a refund?</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">Yes! Click "End Session" and you'll receive a refund for any unused minutes. Example: play 2 min of 5 min = â‚¬3.00 refund.</p>
            </div>

            <div class="profile-section">
                <h3>What is Crazy Menu?</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">The Crazy Menu lets you trigger fun actions like waves, dropping duck, or having operator jump in pool! Prices from â‚¬10 to â‚¬30,000 for legendary actions.</p>
            </div>
        </div>
    </div>

    <!-- TERMS MODAL -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ðŸ“œ Terms of Service</h2>
                <button class="close-modal" onclick="closeModal('termsModal')">&times;</button>
            </div>
            
            <div class="profile-section">
                <h3>1. Acceptance of Terms</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">By using FishArena, you agree to these terms. If you don't agree, please don't use our service.</p>
            </div>

            <div class="profile-section">
                <h3>2. Service Description</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">FishArena provides remote control of real fishing equipment via internet. Service availability not guaranteed.</p>
            </div>

            <div class="profile-section">
                <h3>3. Payment & Refunds</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">Sessions cost â‚¬1/minute. Early termination = automatic refund of unused time. Boost purchases are non-refundable.</p>
            </div>

            <div class="profile-section">
                <h3>4. User Conduct</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">Users must not: abuse equipment, harass others, attempt to hack or exploit the system, or violate any laws.</p>
            </div>

            <div class="profile-section">
                <h3>5. Limitation of Liability</h3>
                <p style="color: #a8b3cf; line-height: 1.6;">FishArena is provided "as is" without warranties. We're not liable for damages arising from use of service.</p>
            </div>
        </div>
    </div>

    <script>
        // ============ FOOTER FUNCTIONS (GLOBAL) ============
        function showTerms() {
            var modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 99999; padding: 20px;';
            modal.onclick = function(e) { if(e.target === modal) modal.remove(); };
            
            var content = '<div style="background: #0a0e27; border-radius: 20px; padding: 40px; max-width: 800px; max-height: 85vh; overflow-y: auto; border: 2px solid rgba(102, 126, 234, 0.3);">';
            content += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">';
            content += '<h2 style="color: #fff; margin: 0;">ðŸ“‹ Terms of Service</h2>';
            content += '<button onclick="this.closest(\'div\').parentElement.parentElement.remove()" style="background: rgba(245, 87, 108, 0.3); border: none; color: #f5576c; font-size: 1.8em; width: 45px; height: 45px; border-radius: 10px; cursor: pointer;">Ã—</button>';
            content += '</div>';
            content += '<div style="color: #a8b3cf; line-height: 1.8; font-size: 0.95em;">';
            content += '<h3 style="color: #667eea; margin-top: 0;">1. Acceptance of Terms</h3>';
            content += '<p>By accessing FishArena, you agree to these Terms of Service.</p>';
            content += '<h3 style="color: #667eea;">2. Service Description</h3>';
            content += '<p>FishArena provides remote control of real fishing rods via live stream. Payment: â‚¬0.30/minute.</p>';
            content += '<h3 style="color: #667eea;">3. User Accounts</h3>';
            content += '<p>Must be 18+ to use. You are responsible for your account security.</p>';
            content += '<h3 style="color: #667eea;">4. Payment Terms</h3>';
            content += '<p>Payments via Stripe. You are charged only for actual time used.</p>';
            content += '<h3 style="color: #667eea;">5. Prohibited Activities</h3>';
            content += '<p>No equipment abuse, disruption of other users, or system hacking.</p>';
            content += '<h3 style="color: #667eea;">6. Limitation of Liability</h3>';
            content += '<p>Service provided "as is". We are not liable for equipment failures or lost catches.</p>';
            content += '<p style="margin-top: 25px; font-size: 0.85em; opacity: 0.7;">Last updated: February 2026</p>';
            content += '</div></div>';
            
            modal.innerHTML = content;
            document.body.appendChild(modal);
        }

        function showPrivacy() {
            var modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 99999; padding: 20px;';
            modal.onclick = function(e) { if(e.target === modal) modal.remove(); };
            
            var content = '<div style="background: #0a0e27; border-radius: 20px; padding: 40px; max-width: 800px; max-height: 85vh; overflow-y: auto; border: 2px solid rgba(102, 126, 234, 0.3);">';
            content += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">';
            content += '<h2 style="color: #fff; margin: 0;">ðŸ”’ Privacy Policy</h2>';
            content += '<button onclick="this.closest(\'div\').parentElement.parentElement.remove()" style="background: rgba(245, 87, 108, 0.3); border: none; color: #f5576c; font-size: 1.8em; width: 45px; height: 45px; border-radius: 10px; cursor: pointer;">Ã—</button>';
            content += '</div>';
            content += '<div style="color: #a8b3cf; line-height: 1.8; font-size: 0.95em;">';
            content += '<h3 style="color: #667eea; margin-top: 0;">Information We Collect</h3>';
            content += '<p><strong>Account:</strong> Email, username, profile picture<br>';
            content += '<strong>Payment:</strong> Via Stripe (we do not store card details)<br>';
            content += '<strong>Usage:</strong> Session data, statistics<br>';
            content += '<strong>Technical:</strong> IP, browser, device</p>';
            content += '<h3 style="color: #667eea;">How We Use Data</h3>';
            content += '<p>To provide service, process payments, track stats, improve UX.</p>';
            content += '<h3 style="color: #667eea;">Data Storage</h3>';
            content += '<p>Secure storage via Firebase (Google Cloud) with industry-standard security.</p>';
            content += '<h3 style="color: #667eea;">Data Sharing</h3>';
            content += '<p>Only with Stripe (payments) and Firebase (hosting). We never sell your data.</p>';
            content += '<h3 style="color: #667eea;">Your Rights</h3>';
            content += '<p>Access, delete, or export your data anytime.</p>';
            content += '<h3 style="color: #667eea;">Contact</h3>';
            content += '<p>Email: <a href="mailto:trad3m1rk@gmail.com" style="color: #667eea; text-decoration: none;">trad3m1rk@gmail.com</a></p>';
            content += '<p style="margin-top: 25px; font-size: 0.85em; opacity: 0.7;">Last updated: February 2026</p>';
            content += '</div></div>';
            
            modal.innerHTML = content;
            document.body.appendChild(modal);
        }

        // ============ STATE MANAGEMENT ============
        let userBalance = 0.00; // Start with 0, or 2 EUR from referral
        let userReferralCode = ''; // Generated on login
        let referredUsers = []; // List of referred user IDs
        let referralEarnings = 0; // Total earned from referrals
        let sessionActive = false;
        let sessionStartTime = 0;
        let timeElapsed = 0; // Seconds elapsed since session start
        let timerInterval;
        const SESSION_COST_PER_MINUTE = 0.30; // â‚¬0.30 per minute
        const SESSION_DURATION = 999999; // Unlimited (no max limit)

        // ============ PARTICLES BACKGROUND ============
        (function() {
            const canvas = document.getElementById('particles-js');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const particleCount = 100;

            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 2,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(102, 126, 234, 0.5)';
                ctx.strokeStyle = 'rgba(102, 126, 234, 0.3)';

                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fill();

                    // Connect particles
                    particles.forEach((p2, j) => {
                        if (i !== j) {
                            const dx = p.x - p2.x;
                            const dy = p.y - p2.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < 100) {
                                ctx.beginPath();
                                ctx.moveTo(p.x, p.y);
                                ctx.lineTo(p2.x, p2.y);
                                ctx.stroke();
                            }
                        }
                    });
                });

                requestAnimationFrame(animate);
            }

            animate();

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        })();

        // ============ FIREBASE INITIALIZATION ============
        let auth, db;
        let currentUser = null;
        let firebaseReady = false;
        let stripe = null; // Stripe instance

        // Initialize Stripe
        if (typeof Stripe !== 'undefined') {
            stripe = Stripe('pk_test_51QlYA5CkcShKRxvAPTmc0HTQBBZ1CPtFI5mfIi9N1YZKv9AqSEem5Yc4rq89Q8grD1P2bh55FidiItGxGMMTE74400crcS72mC');
            console.log('âœ… Stripe initialized!');
        }

        // Wait for Firebase to load
        document.addEventListener('DOMContentLoaded', function() {
            // Check every 100ms if Firebase loaded
            const checkFirebase = setInterval(function() {
                if (typeof firebase !== 'undefined') {
                    clearInterval(checkFirebase);
                    initializeFirebase();
                }
            }, 100);
            
            // Timeout after 5 seconds
            setTimeout(function() {
                clearInterval(checkFirebase);
                if (!firebaseReady) {
                    console.error('Firebase failed to load');
                }
            }, 5000);
        });

        function initializeFirebase() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyCjYlyITbs2g16Iclts1CpImAhLIA1wm2E",
                    authDomain: "fisharena-f837f.firebaseapp.com",
                    projectId: "fisharena-f837f",
                    storageBucket: "fisharena-f837f.firebasestorage.app",
                    messagingSenderId: "725735713349",
                    appId: "1:725735713349:web:4035711a51e125c6eed12c"
                };

                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                firebaseReady = true;

                console.log('âœ… Firebase initialized!');

                // Check if user already logged in
                auth.onAuthStateChanged(function(user) {
                    if (user) {
                        currentUser = user;
                        
                        // Skip email verification reminder
                        // if (!user.emailVerified) {
                        //     showNotification('âš ï¸ Please verify your email. Check your inbox.');
                        // }
                        
                        loadUserData();
                    }
                });
            } catch (error) {
                console.error('Firebase init error:', error);
            }
        }

        async function loadUserData() {
            if (!currentUser || !db) return;
            
            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                if (doc.exists) {
                    const data = doc.data();
                    userBalance = data.balance || 5000;
                    userReferralCode = data.referralCode || generateReferralCode();
                    referredUsers = data.referredUsers || [];
                    referralEarnings = referredUsers.length * 2;
                    updateBalance();
                    showDashboard();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // ============ PAGE NAVIGATION ============
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            handleLogin();
        });

        // Auto-fill referral code from URL if present
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode) {
                document.getElementById('referralCode').value = refCode.toUpperCase();
            }
        });

        // ============ AUTHENTICATION ============
        async function handleLogin() {
            if (!firebaseReady) {
                showNotification('âš ï¸ System loading... Please wait');
                return;
            }

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.textContent = 'Logging in...';
            loginBtn.disabled = true;
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                await loadUserData();
                showNotification('âœ… Welcome back!');
            } catch (error) {
                console.error('Login error:', error);
                if (error.code === 'auth/user-not-found') {
                    showNotification('âŒ Email not found. Please sign up first.');
                } else if (error.code === 'auth/wrong-password') {
                    showNotification('âŒ Incorrect password.');
                } else {
                    showNotification('âŒ Login failed: ' + error.message);
                }
            } finally {
                loginBtn.textContent = 'Login ðŸš€';
                loginBtn.disabled = false;
            }
        }

        async function handleSignup() {
            if (!firebaseReady) {
                showNotification('âš ï¸ System loading... Please wait');
                return;
            }

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const referralCodeInput = document.getElementById('referralCode').value.trim().toUpperCase();
            
            if (!email || !password) {
                showNotification('âš ï¸ Please enter email and password');
                return;
            }
            
            if (password.length < 6) {
                showNotification('âš ï¸ Password must be at least 6 characters');
                return;
            }
            
            try {
                // Check for referral code from URL or input field
                const urlParams = new URLSearchParams(window.location.search);
                const referredBy = referralCodeInput || urlParams.get('ref') || null;
                
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Send email verification
                await currentUser.sendEmailVerification();
                
                // Create user document
                const refCode = generateReferralCode();
                await db.collection('users').doc(currentUser.uid).set({
                    email: email,
                    balance: referredBy ? 2.00 : 0.00, // +â‚¬2 if referred, otherwise 0
                    referralCode: refCode,
                    referredBy: referredBy,
                    referredUsers: [],
                    totalSpent: 0,
                    fishCaught: 0,
                    emailVerified: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Award referrer
                if (referredBy) {
                    const snapshot = await db.collection('users')
                        .where('referralCode', '==', referredBy)
                        .limit(1)
                        .get();
                    
                    if (!snapshot.empty) {
                        const referrerDoc = snapshot.docs[0];
                        await db.collection('users').doc(referrerDoc.id).update({
                            referredUsers: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
                        });
                    }
                }
                
                await loadUserData();
                showSuccess('ðŸŽ‰ Account created! Welcome to FishArena!');
            } catch (error) {
                console.error('Signup error:', error);
                if (error.code === 'auth/email-already-in-use') {
                    showNotification('âŒ Email already registered. Please login instead.');
                } else {
                    showNotification('âŒ Signup failed: ' + error.message);
                }
            }
        }

        // ============ GOOGLE SIGN IN ============
        async function handleSocialLogin() {
            if (!firebaseReady) {
                showNotification('â³ Please wait, Firebase loading...');
                return;
            }

            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                const user = result.user;

                console.log('Google sign in successful:', user.email);

                // Check if user exists in Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();

                if (!userDoc.exists) {
                    // New user - create account
                    const referralCode = generateReferralCode();
                    await db.collection('users').doc(user.uid).set({
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL,
                        balance: 0,
                        fishCaught: 0,
                        totalSpent: 0,
                        referralCode: referralCode,
                        referredUsers: [],
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    showSuccess('ðŸŽ‰ Welcome to FishArena!');
                } else {
                    showSuccess('ðŸ‘‹ Welcome back!');
                }

                // Redirect to dashboard
                setTimeout(() => {
                    window.location.reload();
                }, 1000);

            } catch (error) {
                console.error('Google sign in error:', error);
                
                if (error.code === 'auth/popup-closed-by-user') {
                    showNotification('âš ï¸ Sign in cancelled');
                } else if (error.code === 'auth/popup-blocked') {
                    showNotification('âš ï¸ Popup blocked! Please allow popups for this site.');
                } else {
                    showNotification('âŒ Google sign in failed: ' + error.message);
                }
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                auth.signOut().then(function() {
                    showNotification('ðŸ‘‹ Logged out successfully');
                    setTimeout(function() {
                        window.location.reload();
                    }, 1000);
                }).catch(function(error) {
                    console.error('Logout error:', error);
                });
            }
        }

        // ============ REFERRAL SYSTEM ============
        function generateReferralCode() {
            // Generate unique 6-character code
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function checkReferralCode() {
            // This function is now handled in handleSignup
            // Just log for debugging
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            
            if (refCode && refCode !== userReferralCode) {
                console.log('Referred by code:', refCode);
            }
        }

        function getReferralLink() {
            const baseUrl = window.location.origin + window.location.pathname;
            return baseUrl + '?ref=' + userReferralCode;
        }

        function copyReferralLink() {
            const link = getReferralLink();
            navigator.clipboard.writeText(link).then(() => {
                showNotification('âœ… Referral link copied to clipboard!');
            }).catch(() => {
                showNotification('âš ï¸ Could not copy link. Please copy manually.');
            });
        }

        function showReferrals() {
            showPage('referralsPage');
            updateReferralStats();
        }

        async function showLeaderboard() {
            document.getElementById('leaderboardBalanceAmount').textContent = userBalance.toFixed(2);
            showPage('leaderboardPage');
            
            // Load real leaderboard data from Firebase
            await loadLeaderboardData();
        }

        async function loadLeaderboardData() {
            if (!db) return;
            
            try {
                // Get top 10 users by totalSpent
                const spentSnapshot = await db.collection('users')
                    .orderBy('totalSpent', 'desc')
                    .limit(10)
                    .get();
                
                const spentList = document.getElementById('leaderboardSpentContent');
                if (spentSnapshot.empty) {
                    spentList.innerHTML = '<div style="text-align: center; padding: 40px; color: #a8b3cf;">No data yet. Be the first!</div>';
                } else {
                    spentList.innerHTML = '';
                    let rank = 1;
                    spentSnapshot.forEach(doc => {
                        const data = doc.data();
                        const email = data.email || 'Anonymous';
                        const username = email.split('@')[0]; // Use part before @
                        const spent = (data.totalSpent || 0).toFixed(2);
                        
                        const medal = rank === 1 ? 'ðŸ¥‡' : rank === 2 ? 'ðŸ¥ˆ' : rank === 3 ? 'ðŸ¥‰' : '';
                        const bgColor = rank === 1 ? 'rgba(255, 215, 0, 0.1)' : rank === 2 ? 'rgba(192, 192, 192, 0.1)' : rank === 3 ? 'rgba(205, 127, 50, 0.1)' : 'rgba(255,255,255,0.03)';
                        
                        const item = document.createElement('div');
                        item.style.cssText = `padding: 20px; background: ${bgColor}; border-radius: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;`;
                        item.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 1.5em; font-weight: bold; color: #667eea; min-width: 40px;">${medal} #${rank}</div>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.1em;">${username}</div>
                                    <div style="color: #a8b3cf; font-size: 0.9em;">Total Spent</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.5em; font-weight: bold; color: #43e97b;">â‚¬${spent}</div>
                            </div>
                        `;
                        spentList.appendChild(item);
                        rank++;
                    });
                }
                
                // Get top 10 users by fishCaught
                const fishSnapshot = await db.collection('users')
                    .orderBy('fishCaught', 'desc')
                    .limit(10)
                    .get();
                
                const fishList = document.getElementById('leaderboardFishContent');
                if (fishSnapshot.empty) {
                    fishList.innerHTML = '<div style="text-align: center; padding: 40px; color: #a8b3cf;">No data yet. Catch some fish!</div>';
                } else {
                    fishList.innerHTML = '';
                    let rank = 1;
                    fishSnapshot.forEach(doc => {
                        const data = doc.data();
                        const email = data.email || 'Anonymous';
                        const username = email.split('@')[0];
                        const fish = data.fishCaught || 0;
                        
                        const medal = rank === 1 ? 'ðŸ¥‡' : rank === 2 ? 'ðŸ¥ˆ' : rank === 3 ? 'ðŸ¥‰' : '';
                        const bgColor = rank === 1 ? 'rgba(255, 215, 0, 0.1)' : rank === 2 ? 'rgba(192, 192, 192, 0.1)' : rank === 3 ? 'rgba(205, 127, 50, 0.1)' : 'rgba(255,255,255,0.03)';
                        
                        const item = document.createElement('div');
                        item.style.cssText = `padding: 20px; background: ${bgColor}; border-radius: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;`;
                        item.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 1.5em; font-weight: bold; color: #667eea; min-width: 40px;">${medal} #${rank}</div>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.1em;">${username}</div>
                                    <div style="color: #a8b3cf; font-size: 0.9em;">Fish Caught</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.5em; font-weight: bold; color: #f093fb;">ðŸŽ£ ${fish}</div>
                            </div>
                        `;
                        fishList.appendChild(item);
                        rank++;
                    });
                }
                
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                document.getElementById('leaderboardSpentContent').innerHTML = '<div style="text-align: center; padding: 40px; color: #f5576c;">Error loading data</div>';
            }
        }

        function showLeaderboardTab(tab) {
            // Update button styles
            document.querySelectorAll('.leaderboard-tab').forEach(btn => {
                btn.style.background = 'rgba(255,255,255,0.05)';
                btn.style.borderColor = 'rgba(255,255,255,0.1)';
            });
            
            if (tab === 'fish') {
                document.getElementById('leaderboardFishBtn').style.background = 'rgba(102, 126, 234, 0.2)';
                document.getElementById('leaderboardFishBtn').style.borderColor = '#667eea';
                document.getElementById('leaderboardFishContent').style.display = 'block';
                document.getElementById('leaderboardSpentContent').style.display = 'none';
            } else {
                document.getElementById('leaderboardSpentBtn').style.background = 'rgba(102, 126, 234, 0.2)';
                document.getElementById('leaderboardSpentBtn').style.borderColor = '#667eea';
                document.getElementById('leaderboardFishContent').style.display = 'none';
                document.getElementById('leaderboardSpentContent').style.display = 'block';
            }
        }

        function showHistory() {
            document.getElementById('historyBalanceAmount').textContent = userBalance.toFixed(2);
            showPage('historyPage');
            loadPaymentHistory();
        }

        async function loadPaymentHistory() {
            if (!currentUser || !db) return;
            
            try {
                // In production, load from Firestore
                // For now, show placeholder
                const historyList = document.getElementById('historyList');
                
                // Check if user has made payments (check localStorage for now)
                const pendingPayment = localStorage.getItem('fisharena_payment_history');
                
                if (pendingPayment) {
                    const payments = JSON.parse(pendingPayment);
                    historyList.innerHTML = payments.map(payment => `
                        <div style="padding: 20px; background: rgba(255,255,255,0.03); border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #43e97b;">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                                <div>
                                    <div style="font-weight: 600; font-size: 1.1em; margin-bottom: 5px;">Payment Successful</div>
                                    <div style="color: #a8b3cf; font-size: 0.9em;">${new Date(payment.timestamp).toLocaleString()}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 1.5em; font-weight: bold; color: #43e97b;">+â‚¬${payment.amount}</div>
                                    <div style="color: #a8b3cf; font-size: 0.9em;">via Stripe</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }

        function showReferrals() {
            showPage('referralsPage');
            updateReferralStats();
        }

        function updateReferralStats() {
            document.getElementById('referralLink').value = getReferralLink();
            document.getElementById('referralCount').textContent = referredUsers.length;
            document.getElementById('referralEarnings').textContent = 'â‚¬' + referralEarnings.toFixed(2);
        }

        function showDashboard() {
            // Generate referral code if not exists
            if (!userReferralCode) {
                userReferralCode = generateReferralCode();
            }
            
            // Check if user came from referral link
            checkReferralCode();
            
            updateBalance();
            showPage('dashboardPage');
        }

        // ============ AUTO-LOGIN ON PAGE LOAD ============
        function joinRod(rodNumber) {
            // No balance check here - user can join and watch
            // Balance checked only when starting session
            console.log('Joining rod:', rodNumber);
            updateBalance();
            showPage('rodLobbyPage');
        }

        function logout() {
            if (confirm('Logout?')) {
                showPage('loginPage');
            }
        }

        // ============ BALANCE MANAGEMENT ============
        function updateBalance() {
            document.getElementById('balanceAmount').textContent = userBalance.toFixed(2);
            document.getElementById('lobbyBalanceAmount').textContent = userBalance.toFixed(2);
            
            // Update referral page balance if element exists
            const refBalance = document.getElementById('balanceAmount2');
            if (refBalance) {
                refBalance.textContent = userBalance.toFixed(2);
            }
            
            if (userBalance < 5) {
                document.getElementById('lowBalanceWarning').style.display = 'block';
            } else {
                document.getElementById('lowBalanceWarning').style.display = 'none';
            }
        }

        function deductBalance(amount) {
            userBalance -= amount;
            updateBalance();
            saveBalanceToFirebase(); // Save to database
            
            // Animation effect - try lobby first, then dashboard
            const balanceEl = document.getElementById('lobbyBalance') || document.getElementById('userBalance');
            if (balanceEl) {
                balanceEl.style.transform = 'scale(1.2)';
                balanceEl.style.color = '#f5576c';
                setTimeout(() => {
                    balanceEl.style.transform = 'scale(1)';
                    balanceEl.style.color = '#fff';
                }, 500);
            }
        }

        async function saveBalanceToFirebase() {
            if (!currentUser || !db) return;
            
            try {
                await db.collection('users').doc(currentUser.uid).update({
                    balance: userBalance
                });
            } catch (error) {
                console.error('Error saving balance:', error);
            }
        }

        // ============ SESSION MANAGEMENT ============
        function startSession() {
            const maxSessionCost = SESSION_COST_PER_MINUTE * SESSION_DURATION;
            
            // No balance check - pay as you go!
            // User pays only for actual time used when ending session

            // Show loading
            const btn = document.querySelector('#videoOverlay button');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = 'â³ Starting...';
            }

            // DON'T deduct yet - will deduct on End Session
            sessionActive = true;
            sessionStartTime = Date.now();
            
            const overlay = document.getElementById('videoOverlay');
            const controls = document.getElementById('controls');
            const video = document.getElementById('fishingVideo');
            
            if (overlay) overlay.style.display = 'none';
            if (controls) controls.style.display = 'grid';
            if (video) video.style.display = 'none'; // Hide demo video during session
            
            document.getElementById('userStatus').textContent = 'Controlling ðŸŽ®';
            document.getElementById('queuePosition').textContent = '0';
            
            startTimer();
            
            showSuccess('ðŸŽ® Session started! Timer running...');
            
            // Browser notification if supported
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('FishArena - Your turn!', {
                    body: `Session started! Good luck! ðŸŽ£`,
                    icon: 'ðŸŽ£'
                });
            }
            
            // Reset button
            if (btn) {
                btn.disabled = false;
                btn.innerHTML = 'ðŸŽ® Start Session<br><span style="font-size: 0.7em; opacity: 0.9;">â‚¬0.30/min â€¢ No limit</span>';
            }
        }

        // Request notification permission
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('âœ… Notifications enabled');
                    }
                });
            }
        }

        // Call on page load
        setTimeout(requestNotificationPermission, 3000);

        function endSessionEarly() {
            console.log('End Session clicked! sessionActive:', sessionActive);
            
            if (!sessionActive) {
                showNotification('âš ï¸ No active session to end!');
                return;
            }
            
            // Calculate cost based on time used
            const minutesUsed = timeElapsed / 60;
            const costForTimeUsed = minutesUsed * SESSION_COST_PER_MINUTE;
            
            console.log('Time used:', minutesUsed.toFixed(2), 'min');
            console.log('Cost:', costForTimeUsed.toFixed(2), 'EUR');
            
            // Deduct only time used
            deductBalance(costForTimeUsed);
            
            endSession();
            
            showSuccess(`âœ… Session ended! Time: ${minutesUsed.toFixed(1)} min â€¢ Cost: â‚¬${costForTimeUsed.toFixed(2)}`);
        }

        function endSessionAuto() {
            // Auto-end when 10 minutes reached
            const costForTimeUsed = SESSION_DURATION * SESSION_COST_PER_MINUTE;
            deductBalance(costForTimeUsed);
            endSession();
            showNotification(`â° Session ended - 10 minutes reached! Cost: â‚¬${costForTimeUsed.toFixed(2)}`);
        }

        function startTimer() {
            timeElapsed = 0;
            timerInterval = setInterval(() => {
                timeElapsed++;
                const minutes = Math.floor(timeElapsed / 60);
                const seconds = timeElapsed % 60;
                const timerElement = document.getElementById('timer');
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // No auto-end - unlimited session
            }, 1000);
        }

        function endSession() {
            try {
                const sessionSeconds = timeElapsed; // Real seconds played this session
                
                clearInterval(timerInterval);
                sessionActive = false;
                timeElapsed = 0;
                
                const controlsEl = document.getElementById('controls');
                const overlayEl = document.getElementById('videoOverlay');
                const statusEl = document.getElementById('userStatus');
                const timerEl = document.getElementById('timer');
                const video = document.getElementById('fishingVideo');
                
                if (controlsEl) controlsEl.style.display = 'none';
                if (overlayEl) overlayEl.style.display = 'flex';
                if (video) video.style.display = 'block';
                if (statusEl) statusEl.textContent = 'In Queue';
                if (timerEl) {
                    timerEl.textContent = '00:00';
                    timerEl.classList.remove('warning');
                }
                
                // Save REAL playtime to Firebase
                if (currentUser && db && sessionSeconds > 0) {
                    db.collection('users').doc(currentUser.uid).update({
                        totalPlaytimeSeconds: firebase.firestore.FieldValue.increment(sessionSeconds)
                    }).catch(err => console.error('Error saving playtime:', err));
                }
                
                // Exit fullscreen if active
                if (document.fullscreenElement) {
                    document.exitFullscreen().catch(err => console.log('Fullscreen exit error:', err));
                }
                
                showNotification('â° Session ended! Balance: â‚¬' + userBalance.toFixed(2));
            } catch (error) {
                console.error('Error in endSession:', error);
                sessionActive = false;
            }
        }

        // ============ BOOST PURCHASES ============
        function buyBoost(boostType, price) {
            if (!sessionActive) {
                showWarning('âš ï¸ Start a session first!');
                return;
            }
            
            if (userBalance < price) {
                showWarning(`âš ï¸ Insufficient balance! Need â‚¬${price.toFixed(2)}`);
                return;
            }
            
            deductBalance(price);
            
            // Update totalSpent in Firebase
            if (currentUser && db) {
                db.collection('users').doc(currentUser.uid).update({
                    totalSpent: firebase.firestore.FieldValue.increment(price)
                }).catch(err => console.error('Error updating totalSpent:', err));
            }
            
            const boosts = {
                'bread': { name: 'Bread Crumbs', icon: 'ðŸž', description: 'Attracts small fish!' },
                'worm': { name: 'Premium Worm', icon: 'ðŸª±', description: 'Irresistible to big fish!' },
                'turbo': { name: 'Turbo Reel', icon: 'âš¡', description: 'Super fast reel-in!' }
            };
            
            const boost = boosts[boostType] || { name: boostType, icon: 'ðŸ”¥', description: 'Boost activated!' };
            
            sendCommand(boostType);
            showSuccess(`${boost.icon} ${boost.name} activated! ${boost.description}`);
        }

        function sendCommand(command) {
            if (!sessionActive && !['rotate-left', 'rotate-right', 'lower', 'raise'].includes(command)) {
                return;
            }
            
            const commands = {
                'bread': 'ðŸž Throwing bread crumbs...',
                'worm': 'ðŸª± Casting premium worm...',
                'turbo': 'âš¡ Turbo reel engaged!',
                'cast': 'ðŸŽ£ Casting bait...',
                'reel': 'ðŸ”„ Reeling in...',
                'hook': 'âš¡ Hook set!',
                'rotate-left': 'â†¶ Rotating left...',
                'rotate-right': 'â†· Rotating right...',
                'lower': 'â¬‡ï¸ Lowering rod...',
                'raise': 'â¬†ï¸ Raising rod...'
            };
            
            if (commands[command]) {
                showInfo(commands[command]);
            }
            console.log('Command sent:', command, new Date().toISOString());
        }

        // ============ KEYBOARD CONTROLS ============
        document.addEventListener('keydown', function(e) {
            if (!sessionActive) return;
            
            // Prevent default for game keys
            if (!e.key) return; // Fix: check if e.key exists
            
            const gameKeys = ['w', 'a', 's', 'd', '1', '2', '3', '4', ' ', 'f'];
            if (gameKeys.includes(e.key.toLowerCase())) {
                e.preventDefault();
            }
            
            switch(e.key.toLowerCase()) {
                // Line control (free)
                case 'w':
                    sendCommand('raise');
                    break;
                case 's':
                    sendCommand('lower');
                    break;
                
                // Rotation (free)
                case 'a':
                    sendCommand('rotate-left');
                    break;
                case 'd':
                    sendCommand('rotate-right');
                    break;
                
                // Boosts (cost money)
                case '1':
                    buyBoost('cast', 0.50);
                    break;
                case '2':
                    buyBoost('reel', 0.30);
                    break;
                case '3':
                    buyBoost('hook', 0.40);
                    break;
                case '4':
                    buyBoost('turbo', 1.00);
                    break;
                case ' ':
                    buyBoost('turbo', 1.00); // Space also triggers turbo
                    break;
                
                // Fullscreen
                case 'f':
                    toggleFullscreen();
                    break;
            }
        });

        // ============ FULLSCREEN MODE ============
        function toggleFullscreen() {
            const videoSection = document.querySelector('.video-section');
            
            if (!document.fullscreenElement) {
                videoSection.requestFullscreen().then(() => {
                    videoSection.classList.add('fullscreen-mode');
                    document.getElementById('fullscreenBtn').querySelector('.control-label').textContent = 'Exit FS';
                }).catch(err => {
                    console.log('Fullscreen error:', err);
                    showNotification('âš ï¸ Fullscreen not supported');
                });
            } else {
                document.exitFullscreen().then(() => {
                    videoSection.classList.remove('fullscreen-mode');
                    document.getElementById('fullscreenBtn').querySelector('.control-label').textContent = 'Fullscreen';
                });
            }
        }

        // Listen for fullscreen changes
        document.addEventListener('fullscreenchange', function() {
            const videoSection = document.querySelector('.video-section');
            if (!document.fullscreenElement) {
                videoSection.classList.remove('fullscreen-mode');
                if (document.getElementById('fullscreenBtn')) {
                    document.getElementById('fullscreenBtn').querySelector('.control-label').textContent = 'Fullscreen';
                }
            }
        });

        // ============ CUSTOM VIDEO PLAYER FUNCTIONS ============
        let isPlaying = false;
        let settingsOpen = false;

        function togglePlayPause() {
            const video = document.getElementById('liveStream');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const centerPlayBtn = document.getElementById('centerPlayBtn');
            
            if (video.paused) {
                video.play();
                playPauseBtn.textContent = 'â¸ï¸';
                centerPlayBtn.classList.remove('show');
                isPlaying = true;
            } else {
                video.pause();
                playPauseBtn.textContent = 'â–¶ï¸';
                centerPlayBtn.classList.add('show');
                centerPlayBtn.textContent = 'â–¶ï¸';
                isPlaying = false;
            }
        }

        function toggleMute() {
            const video = document.getElementById('liveStream');
            const volumeBtn = document.getElementById('volumeBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            
            if (video.muted) {
                video.muted = false;
                volumeBtn.textContent = 'ðŸ”Š';
                volumeSlider.value = video.volume * 100;
            } else {
                video.muted = true;
                volumeBtn.textContent = 'ðŸ”‡';
                volumeSlider.value = 0;
            }
        }

        function changeVolume(value) {
            const video = document.getElementById('liveStream');
            const volumeBtn = document.getElementById('volumeBtn');
            
            video.volume = value / 100;
            video.muted = false;
            
            if (value == 0) {
                volumeBtn.textContent = 'ðŸ”‡';
                video.muted = true;
            } else if (value < 50) {
                volumeBtn.textContent = 'ðŸ”‰';
            } else {
                volumeBtn.textContent = 'ðŸ”Š';
            }
        }

        function toggleSettings() {
            const settingsMenu = document.getElementById('settingsMenu');
            settingsOpen = !settingsOpen;
            
            if (settingsOpen) {
                settingsMenu.classList.add('show');
            } else {
                settingsMenu.classList.remove('show');
            }
        }

        function changeQuality(quality) {
            // In production, this would switch video sources
            const qualityBadge = document.getElementById('qualityBadge');
            const items = document.querySelectorAll('.settings-menu-item');
            
            items.forEach(item => {
                item.classList.remove('active');
                if (item.textContent.includes(quality)) {
                    item.classList.add('active');
                    item.innerHTML = item.textContent.replace('âœ“', '').trim() + ' âœ“';
                } else {
                    item.innerHTML = item.textContent.replace('âœ“', '').trim();
                }
            });
            
            qualityBadge.textContent = quality === '1080p' ? 'HD 1080p' : quality === '720p' ? 'HD 720p' : quality;
            showSuccess(`Quality changed to ${quality}`);
            toggleSettings();
        }

        async function togglePiP() {
            const video = document.getElementById('liveStream');
            
            try {
                if (document.pictureInPictureElement) {
                    await document.exitPictureInPicture();
                } else {
                    await video.requestPictureInPicture();
                    showSuccess('ðŸ“º Picture-in-Picture enabled');
                }
            } catch (error) {
                console.error('PiP error:', error);
                showNotification('âš ï¸ Picture-in-Picture not supported');
            }
        }

        function toggleFullscreenCustom() {
            const videoPlayer = document.getElementById('customVideoPlayer');
            const fullscreenBtn = document.getElementById('fullscreenBtnCustom');
            
            if (!document.fullscreenElement) {
                videoPlayer.requestFullscreen().then(() => {
                    fullscreenBtn.textContent = 'â›¶';
                }).catch(err => {
                    console.log('Fullscreen error:', err);
                    showNotification('âš ï¸ Fullscreen not supported');
                });
            } else {
                document.exitFullscreen().then(() => {
                    fullscreenBtn.textContent = 'â›¶';
                });
            }
        }

        function updateProgress() {
            const video = document.getElementById('liveStream');
            const progressBar = document.getElementById('progressBar');
            const currentTimeEl = document.getElementById('currentTime');
            const durationEl = document.getElementById('duration');
            
            if (video.duration) {
                const progress = (video.currentTime / video.duration) * 100;
                progressBar.style.width = progress + '%';
                
                currentTimeEl.textContent = formatTime(video.currentTime);
                durationEl.textContent = formatTime(video.duration);
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function seekVideo(e) {
            const progressContainer = document.getElementById('progressContainer');
            const video = document.getElementById('liveStream');
            
            const rect = progressContainer.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            video.currentTime = pos * video.duration;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            const video = document.getElementById('liveStream');
            
            // Only if video player is visible
            if (!document.getElementById('customVideoPlayer')) return;
            
            // Check if key exists
            if (!e.key) return;
            
            switch(e.key.toLowerCase()) {
                case ' ':
                    if (e.target.tagName !== 'INPUT') {
                        e.preventDefault();
                        togglePlayPause();
                    }
                    break;
                case 'f':
                    toggleFullscreenCustom();
                    break;
                case 'm':
                    toggleMute();
                    break;
                case 'p':
                    togglePiP();
                    break;
                case 'arrowleft':
                    video.currentTime = Math.max(0, video.currentTime - 5);
                    break;
                case 'arrowright':
                    video.currentTime = Math.min(video.duration, video.currentTime + 5);
                    break;
                case 'arrowup':
                    e.preventDefault();
                    video.volume = Math.min(1, video.volume + 0.1);
                    document.getElementById('volumeSlider').value = video.volume * 100;
                    changeVolume(video.volume * 100);
                    break;
                case 'arrowdown':
                    e.preventDefault();
                    video.volume = Math.max(0, video.volume - 0.1);
                    document.getElementById('volumeSlider').value = video.volume * 100;
                    changeVolume(video.volume * 100);
                    break;
            }
        });

        // Initialize video player
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('liveStream');
            const progressContainer = document.getElementById('progressContainer');
            
            if (video) {
                // Update progress
                video.addEventListener('timeupdate', updateProgress);
                
                // Click on progress bar
                if (progressContainer) {
                    progressContainer.addEventListener('click', seekVideo);
                }
                
                // Show center play button when paused
                video.addEventListener('pause', function() {
                    document.getElementById('centerPlayBtn').classList.add('show');
                });
                
                video.addEventListener('play', function() {
                    document.getElementById('centerPlayBtn').classList.remove('show');
                });
            }
        });

        function updateTelemetry() {
            if (!sessionActive) return;
            document.getElementById('tension').textContent = (Math.random() * 3).toFixed(1) + ' kg';
            document.getElementById('depth').textContent = Math.floor(Math.random() * 5) + ' m';
            document.getElementById('speed').textContent = (Math.random() * 2).toFixed(1) + ' m/s';
        }

        // ============ CHAT ============
        // ============ CRAZY MENU ============
        function buyCrazy(action, price) {
            if (userBalance < price) {
                showWarning('âš ï¸ Insufficient balance! Need â‚¬' + price);
                return;
            }
            
            deductBalance(price);
            
            // Action descriptions
            const actions = {
                'wave': { name: 'Wave Effect', icon: 'ðŸŒŠ', description: 'Creating waves in the pool!' },
                'feed': { name: 'Feed Fish', icon: 'ðŸŸ', description: 'Feeding the fish!' },
                'lights': { name: 'RGB Lights', icon: 'ðŸ’¡', description: 'Colorful lights activated for 1 minute!' },
                'beer': { name: 'Beer', icon: 'ðŸº', description: 'Operator drinks beer on stream!' },
                'vodka': { name: 'Vodka Shot', icon: 'ðŸ§Š', description: 'Operator takes a vodka shot!' },
                'champagne': { name: 'Champagne', icon: 'ðŸ¾', description: 'Champagne celebration!' },
                'duck': { name: 'Duck Drop', icon: 'ðŸ¦†', description: 'Rubber duck dropped in the pool!' },
                'bucket': { name: 'Water Bucket', icon: 'ðŸª£', description: 'Water bucket on operator!' },
                'operator-swim': { name: 'Operator Swim', icon: 'ðŸ’¦', description: 'Operator jumps in the pool!' },
                'pike': { name: 'Add Pike', icon: 'ðŸ¦ˆ', description: 'Live pike added to the pool!' }
            };
            
            const actionData = actions[action] || { name: action, icon: 'ðŸ”¥', description: 'Action activated!' };
            
            // Show success notification
            showSuccess(`${actionData.icon} ${actionData.name} purchased! ${actionData.description}`);
            
            // Chat removed - no need to add message
            
            // Visual effect on screen
            createCrazyEffect(actionData.icon);
            
            // Save to history and UPDATE STATS
            saveCrazyMenuPurchase(action, price);
            updatePlayerStats(price); // Add to totalSpent
        }

        async function updatePlayerStats(amount) {
            if (!currentUser || !db) return;
            
            try {
                const userRef = db.collection('users').doc(currentUser.uid);
                await userRef.update({
                    totalSpent: firebase.firestore.FieldValue.increment(amount)
                });
                console.log('Stats updated: +â‚¬' + amount.toFixed(2));
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        function createCrazyEffect(icon) {
            const effect = document.createElement('div');
            effect.innerHTML = icon;
            effect.style.cssText = `
                position: fixed;
                font-size: 100px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0);
                z-index: 10001;
                animation: crazyPop 1s ease;
                pointer-events: none;
            `;
            
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 1000);
        }

        function saveCrazyMenuPurchase(action, price) {
            try {
                const history = JSON.parse(localStorage.getItem('fisharena_crazy_history') || '[]');
                history.unshift({
                    action: action,
                    price: price,
                    timestamp: Date.now()
                });
                // Keep only last 50
                localStorage.setItem('fisharena_crazy_history', JSON.stringify(history.slice(0, 50)));
            } catch (e) {
                console.error('Error saving crazy history:', e);
            }
        }

        // ============ NOTIFICATIONS ============
        function showNotification(message, type = 'info') {
            // Remove old toasts if too many
            const existingToasts = document.querySelectorAll('.toast');
            if (existingToasts.length >= 3) {
                existingToasts[0].remove();
            }

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // Icon based on type
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">${message}</div>
                <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            document.body.appendChild(toast);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                toast.style.animation = 'toastSlideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Shorthand functions
        function showSuccess(message) {
            showNotification(message, 'success');
        }

        function showError(message) {
            showNotification(message, 'error');
        }

        function showWarning(message) {
            showNotification(message, 'warning');
        }

        function showInfo(message) {
            showNotification(message, 'info');
        }

        // ============ MODALS ============
        async function showProfile() {
            if (!currentUser) {
                showNotification('âš ï¸ Please login first');
                return;
            }

            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Show profile page
            document.getElementById('profilePage').classList.add('active');

            // Load user data from Firestore
            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                if (doc.exists) {
                    const data = doc.data();
                    
                    // Update new profile page
                    document.getElementById('profilePageName').textContent = currentUser.email.split('@')[0];
                    document.getElementById('profilePageEmail').textContent = currentUser.email;
                    document.getElementById('profilePageBalance').textContent = (data.balance || userBalance).toFixed(2);
                    
                    // Load avatar
                    const avatarURL = data.avatarURL || currentUser.photoURL;
                    if (avatarURL) {
                        const img = `<img src="${avatarURL}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                        document.getElementById('profileAvatarLarge').innerHTML = img;
                    } else {
                        document.getElementById('profileAvatarLarge').innerHTML = 'ðŸ‘¤';
                    }
                    
                    // Inline stats in hero
                    document.getElementById('profileFishCaughtInline').textContent = data.fishCaught || 0;
                    document.getElementById('profileTotalSpentInline').textContent = 'â‚¬' + (data.totalSpent || 0).toFixed(2);
                    document.getElementById('profileReferralsInline').textContent = (data.referredUsers || []).length;
                    
                    // Playtime from REAL session time (in seconds), NOT from money spent
                    const totalSeconds = data.totalPlaytimeSeconds || 0;
                    const playtimeHours = Math.floor(totalSeconds / 3600);
                    const playtimeMinutes = Math.floor((totalSeconds % 3600) / 60);
                    if (playtimeHours > 0) {
                        document.getElementById('profilePlaytimeInline').textContent = playtimeHours + 'h ' + playtimeMinutes + 'm';
                    } else {
                        document.getElementById('profilePlaytimeInline').textContent = playtimeMinutes + 'm';
                    }
                    
                    // Member since
                    if (data.createdAt) {
                        const date = data.createdAt.toDate();
                        const options = { year: 'numeric', month: 'long' };
                        document.getElementById('profileMemberSinceDate').textContent = date.toLocaleDateString('en-US', options);
                    }
                    
                    // Add VIP badge if spent > â‚¬100
                    if ((data.totalSpent || 0) > 100) {
                        const badgesContainer = document.querySelector('.profile-badges');
                        if (!document.getElementById('vipBadge')) {
                            const vipBadge = document.createElement('div');
                            vipBadge.id = 'vipBadge';
                            vipBadge.className = 'badge vip';
                            vipBadge.innerHTML = 'ðŸ‘‘ VIP Member';
                            badgesContainer.appendChild(vipBadge);
                        }
                    }
                    
                    // Load achievements
                    loadAchievements(data);
                    
                    // Also fill old modal for backward compatibility
                    document.getElementById('profileEmail').value = currentUser.email;
                    document.getElementById('profileRefCode').value = data.referralCode || userReferralCode;
                    document.getElementById('profileBalance').value = 'â‚¬' + (data.balance || userBalance).toFixed(2);
                    document.getElementById('profileFishCaught').textContent = data.fishCaught || 0;
                    document.getElementById('profileTotalSpent').textContent = 'â‚¬' + (data.totalSpent || 0).toFixed(2);
                    document.getElementById('profileReferrals').textContent = (data.referredUsers || []).length;
                    
                    if (data.createdAt) {
                        const date = data.createdAt.toDate();
                        const options = { year: 'numeric', month: 'long' };
                        document.getElementById('profileMemberSince').textContent = date.toLocaleDateString('en-US', options);
                    }
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                showNotification('âŒ Error loading profile data');
            }
        }


        function loadAchievements(userData) {
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';
            
            const achievements = [
                {
                    icon: 'ðŸŽ£',
                    title: 'First Catch',
                    desc: 'Catch your first fish',
                    unlocked: (userData.fishCaught || 0) >= 1,
                    date: 'January 2025'
                },
                {
                    icon: 'ðŸŸ',
                    title: 'Fish Master',
                    desc: 'Catch 10 fish',
                    unlocked: (userData.fishCaught || 0) >= 10,
                    date: 'February 2025'
                },
                {
                    icon: 'ðŸ’°',
                    title: 'Big Spender',
                    desc: 'Spend â‚¬50 total',
                    unlocked: (userData.totalSpent || 0) >= 50,
                    date: 'January 2025'
                },
                {
                    icon: 'ðŸ‘¥',
                    title: 'Social Fisherman',
                    desc: 'Refer 3 friends',
                    unlocked: (userData.referredUsers || []).length >= 3,
                    date: 'February 2025'
                },
                {
                    icon: 'â±ï¸',
                    title: 'Time Master',
                    desc: 'Play for 10 hours',
                    unlocked: ((userData.totalSpent || 0) / 0.30) >= 600,
                    date: 'January 2025'
                },
                {
                    icon: 'ðŸ†',
                    title: 'Champion',
                    desc: 'Reach top 10 on leaderboard',
                    unlocked: false,
                    date: 'Locked'
                }
            ];
            
            achievements.forEach(achievement => {
                const item = document.createElement('div');
                item.className = 'achievement-item' + (achievement.unlocked ? '' : ' achievement-locked');
                item.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-desc">${achievement.desc}</div>
                        <div class="achievement-date">${achievement.unlocked ? 'âœ… Unlocked - ' + achievement.date : 'ðŸ”’ ' + achievement.date}</div>
                    </div>
                `;
                achievementsList.appendChild(item);
            });
        }

        async function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                showNotification('âš ï¸ Image too large. Max 5MB');
                return;
            }
            
            if (!currentUser) {
                showNotification('âš ï¸ Please login first');
                return;
            }
            
            try {
                showNotification('ðŸ“¤ Uploading avatar...');
                
                // Upload to Firebase Storage
                const storageRef = firebase.storage().ref();
                const avatarRef = storageRef.child(`avatars/${currentUser.uid}`);
                
                await avatarRef.put(file);
                const downloadURL = await avatarRef.getDownloadURL();
                
                // Update user profile in Firebase Auth
                await currentUser.updateProfile({
                    photoURL: downloadURL
                });
                
                // Update Firestore
                await db.collection('users').doc(currentUser.uid).update({
                    avatarURL: downloadURL
                });
                
                // Update UI
                const img = `<img src="${downloadURL}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                document.getElementById('profileAvatarLarge').innerHTML = img;
                
                // Update all avatar instances
                document.querySelectorAll('.user-avatar').forEach(el => {
                    el.innerHTML = img;
                });
                
                showSuccess('âœ… Avatar updated successfully!');
                
            } catch (err) {
                console.error('Avatar upload error:', err);
                showNotification('âŒ Error uploading avatar: ' + err.message);
            }
        }

        async function changePasswordFromProfile() {
            const newPassword = document.getElementById('profileNewPassword').value;
            const confirmPassword = document.getElementById('profileConfirmPassword').value;

            if (!newPassword || !confirmPassword) {
                showNotification('âš ï¸ Please fill in all password fields');
                return;
            }

            if (newPassword.length < 6) {
                showNotification('âš ï¸ Password must be at least 6 characters');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification('âš ï¸ Passwords do not match');
                return;
            }

            try {
                // For security, Firebase requires reauthentication for password change
                // Prompt user for current password
                const currentPassword = prompt('For security, please enter your CURRENT password:');
                
                if (!currentPassword) {
                    showNotification('âš ï¸ Current password required');
                    return;
                }
                
                // Reauthenticate
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email,
                    currentPassword
                );
                
                await currentUser.reauthenticateWithCredential(credential);
                
                // Now update password
                await currentUser.updatePassword(newPassword);
                showSuccess('âœ… Password updated successfully!');
                document.getElementById('profileNewPassword').value = '';
                document.getElementById('profileConfirmPassword').value = '';
            } catch (error) {
                console.error('Password change error:', error);
                if (error.code === 'auth/wrong-password') {
                    showNotification('âŒ Current password is incorrect');
                } else if (error.code === 'auth/requires-recent-login') {
                    showNotification('âš ï¸ Please logout and login again, then try changing password');
                } else {
                    showNotification('âŒ Failed to update password: ' + error.message);
                }
            }
        }

        async function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!newPassword || !confirmPassword) {
                showNotification('âš ï¸ Please fill in all password fields');
                return;
            }

            if (newPassword.length < 6) {
                showNotification('âš ï¸ Password must be at least 6 characters');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification('âš ï¸ Passwords do not match');
                return;
            }

            try {
                await currentUser.updatePassword(newPassword);
                showNotification('âœ… Password updated successfully!');
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                closeModal('profileModal');
            } catch (error) {
                console.error('Password change error:', error);
                if (error.code === 'auth/requires-recent-login') {
                    showNotification('âš ï¸ Please logout and login again before changing password');
                } else {
                    showNotification('âŒ Failed to update password: ' + error.message);
                }
            }
        }

        function showFAQ() {
            document.getElementById('faqModal').classList.add('active');
        }

        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // ============ ADD FUNDS ============
        function addFunds() {
            if (!currentUser) {
                showNotification('âš ï¸ Please login first');
                return;
            }

            // Update balance display on payment page
            document.getElementById('paymentBalanceAmount').textContent = userBalance.toFixed(2);
            
            // Show payment page
            showPage('paymentPage');
        }

        function processPayment(choice) {
            // Show loading state
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div style="display: inline-block; width: 16px; height: 16px; border: 2px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 0.6s linear infinite;"></div> Processing...';
            
            // Add spinner animation
            if (!document.getElementById('spinnerStyle')) {
                const style = document.createElement('style');
                style.id = 'spinnerStyle';
                style.textContent = `
                    @keyframes spin {
                        to { transform: rotate(360deg); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Stripe Payment Links
            const paymentLinks = {
                '1': { url: 'https://buy.stripe.com/aFacN4byEd1V5fCbsocV201', amount: 3 },
                '2': { url: 'https://buy.stripe.com/4gM3cubyEe5Z37ucwscV202', amount: 10 },
                '3': { url: 'https://buy.stripe.com/eVqcN446c2nheQc2VScV203', amount: 20 }
            };

            const selected = paymentLinks[choice.toString()];
            
            // Save payment intent to localStorage
            localStorage.setItem('fisharena_payment_pending', JSON.stringify({
                userId: currentUser.uid,
                amount: selected.amount,
                timestamp: Date.now()
            }));

            showNotification('ðŸ’³ Redirecting to secure payment page...');
            
            // Redirect to Stripe Payment Link
            setTimeout(() => {
                window.location.href = selected.url + '?prefilled_email=' + encodeURIComponent(currentUser.email);
            }, 1500);
        }

        // Check for payment completion on page load
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const paymentStatus = urlParams.get('payment');
            const amount = urlParams.get('amount');

            // Check if returning from successful payment
            const pendingPayment = localStorage.getItem('fisharena_payment_pending');
            
            if (pendingPayment && currentUser) {
                const payment = JSON.parse(pendingPayment);
                
                // Check if payment is within last 5 minutes
                if (Date.now() - payment.timestamp < 300000) {
                    // Add funds to balance
                    userBalance += payment.amount;
                    updateBalance();
                    saveBalanceToFirebase();
                    showSuccess(`âœ… Payment successful! â‚¬${payment.amount} added to your balance!`);
                    
                    // Save to payment history
                    const history = JSON.parse(localStorage.getItem('fisharena_payment_history') || '[]');
                    history.unshift({
                        amount: payment.amount,
                        timestamp: Date.now(),
                        status: 'success',
                        method: 'Stripe'
                    });
                    localStorage.setItem('fisharena_payment_history', JSON.stringify(history.slice(0, 50)));
                    
                    // Clear pending payment
                    localStorage.removeItem('fisharena_payment_pending');
                    
                    // Clean URL if has payment params
                    if (window.location.search) {
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                }
            }
        });

        // ============ AUTO-PLAY VIDEOS ============
        window.addEventListener('load', () => {
            document.querySelectorAll('video').forEach(video => {
                video.play().catch(e => console.log('Autoplay blocked'));
            });
        });

        // ============ STATS UPDATE ============
        setInterval(() => {
            const stat = document.getElementById('playersOnline');
            if (stat) {
                const current = parseInt(stat.textContent);
                stat.textContent = Math.max(100, current + Math.floor(Math.random() * 10) - 5);
            }
        }, 3000);
    </script>

    <!-- FOOTER -->
    <footer style="background: rgba(10, 14, 39, 0.9); border-top: 1px solid rgba(102, 126, 234, 0.2); padding: 40px 20px; margin-top: 80px; position: relative; z-index: 100; pointer-events: auto;">
        <div style="max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
            <div style="color: #a8b3cf; font-size: 0.9em;">
                Â© 2026 FishArena. All rights reserved.
            </div>
            <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                <a href="#" onclick="showTerms(); return false;" style="color: #a8b3cf; text-decoration: none; font-size: 0.9em; transition: color 0.3s; cursor: pointer; position: relative; z-index: 1;" onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#a8b3cf'">Terms of Service</a>
                <a href="#" onclick="showPrivacy(); return false;" style="color: #a8b3cf; text-decoration: none; font-size: 0.9em; transition: color 0.3s; cursor: pointer; position: relative; z-index: 1;" onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#a8b3cf'">Privacy Policy</a>
                <a href="/cdn-cgi/l/email-protection#c8bcbaa9acfba5f9baa388afa5a9a1a4e6aba7a5" style="color: #a8b3cf; text-decoration: none; font-size: 0.9em; transition: color 0.3s; cursor: pointer; position: relative; z-index: 1;" onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#a8b3c